<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="專業數位名片製作工具 - 線上免費創建和匯出精美的電子名片，支援PNG、JPG、WebP、HTML和vCard格式。提供多種設計範本、動畫效果、漸層顏色等功能。">
    <meta name="keywords" content="數位名片,線上名片製作,電子名片,商務卡,數位明信片,名片製作工具,免費工具,線上編輯器,個人名片,數位名片製作">
    <meta name="author" content="Virtual Card Maker">
    <meta name="theme-color" content="#667eea">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f0c29">
    <meta name="format-detection" content="telephone=no">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta property="og:title" content="數位名片製作 - 線上免費工具">
    <meta property="og:description" content="快速創建專業的電子名片，支援多種格式匯出。無需設計經驗，即可製作高質感數位明信片。">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_TW">
    <meta property="og:url" content="https://lian0123.github.io/virtual-business-card-project/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="數位名片製作 - 線上免費工具">
    <meta name="twitter:description" content="快速創建專業的數位明信片和電子名片">
    <title>數位名片製作 - 線上免費電子名片生成器 | Digital Business Card Maker</title>
    <link rel="canonical" href="https://lian0123.github.io/virtual-business-card-project/">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="數位名片">
    <meta name="application-name" content="數位名片">
    <link rel="alternate" type="application/json" href="./skill.json">
    <link rel="alternate" type="application/json" href="./webmcp.json">
    <link rel="alternate" type="application/vnd.oai.openapi" href="./webmcp.openapi.yaml" title="WebMCP OpenAPI 3.1">
    <link rel="alternate" type="text/html" href="./webmcp-example.html">
    <link rel="icon" type="image/png" sizes="16x16" href="./public/icons/favicon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./public/icons/favicon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./public/icons/apple-touch-icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="manifest" href="./manifest.webmanifest" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="./src/webmcp-chromium.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* 新增动画效果 */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes floatingAnimation {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0e27;
            color: #e0e0e0;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        body.light-theme {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #1a1a1a;
        }

        body.dark-theme {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
        }

        body.rtl-lang {
            direction: rtl;
        }

        body.rtl-lang .panel-header {
            align-items: flex-end;
        }

        body.rtl-lang .header-controls {
            flex-direction: row-reverse;
        }

        body.rtl-lang .control-label,
        body.rtl-lang .section-title {
            text-align: right;
        }

        #root {
            width: 100%;
            min-height: 100vh;
        }

        .app-container {
            display: grid;
            grid-template-columns: 480px 1fr;
            min-height: 100vh;
            animation: fadeIn 0.5s ease-in;
            gap: 1px;
        }

        .control-panel {
            max-height: 100vh;
            background: linear-gradient(135deg, #1a1f3a 0%, #16213e 100%);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
            animation: slideInLeft 0.6s ease-out;
            transition: all 0.3s ease;
        }

        body.light-theme .control-panel {
            background: linear-gradient(135deg, #f9fafb 0%, #eff2f5 100%);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            padding: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            gap: 10px;
            animation: slideInDown 0.6s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel-header h1 {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #fff;
            margin: 0;
            line-height: 1.25;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            animation: fadeInScale 0.6s ease-out 0.1s backwards;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
        }

        .theme-toggle,
        .lang-selector,
        .github-link {
            min-height: 36px;
            height: 36px;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #fff;
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .github-link:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .theme-toggle {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lang-selector {
            min-width: 150px;
            max-width: 200px;
        }

        .lang-selector:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .lang-selector option {
            background: #333;
            color: #fff;
        }

        .panel-content {
            padding: 24px;
        }

        body.light-theme .panel-content {
            color: #1a1a1a;
        }

        .section {
            margin-bottom: 28px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: #667eea;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.light-theme .section-title {
            color: #667eea;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #b0b0b0;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        body.light-theme .control-label {
            color: #666;
        }

        .control-input,
        .control-select,
        textarea.control-input {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 13px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .control-select,
        .button-toggle,
        .control-input:not(textarea) {
            min-height: 40px;
        }

        body.light-theme .control-input,
        body.light-theme .control-select,
        body.light-theme textarea.control-input {
            background: #fff;
            border: 1px solid #e0e0e0;
            color: #1a1a1a;
        }

        .control-input:focus,
        .control-select:focus,
        textarea.control-input:focus {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
            outline: none;
        }

        body.light-theme .control-input:focus,
        body.light-theme .control-select:focus,
        body.light-theme textarea.control-input:focus {
            background: #f9f9f9;
            border-color: #667eea;
        }

        .color-picker {
            flex: 1;
            height: 44px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        body.light-theme .color-picker {
            border: 1px solid #e0e0e0;
        }

        .slider-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .slider-wrapper input[type="range"] {
            flex: 1;
            accent-color: #667eea;
        }

        .slider-value {
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            min-width: 45px;
            text-align: right;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }

        .button-toggle {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #b0b0b0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .button-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .button-toggle.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: #fff;
            animation: fadeInScale 0.3s ease;
        }

        .button-toggle:active {
            transform: translateY(0);
        }

        body.light-theme .button-toggle {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #666;
        }

        .button-toggle.active {
            background: #667eea;
            border-color: #667eea;
            color: #fff;
        }

        .button-toggle:hover:not(.active) {
            border-color: rgba(255, 255, 255, 0.2);
        }

        body.light-theme .button-toggle:hover:not(.active) {
            border-color: #ccc;
        }

        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            background: #0a0e27;
            position: relative;
            animation: slideInRight 0.6s ease-out;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 100vh;
            transition: background 0.3s ease;
        }

        body.light-theme .preview-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .preview-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .card-wrapper {
            position: relative;
            width: 500px;
            height: 300px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            overflow: hidden;
        }

        .main-card-wrapper {
            display: flex;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .main-card-left {
            width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .main-card-right {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.98);
        }

        .card-avatar {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .qr-card-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-around;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            padding: 25px;
        }

        .qr-card-left {
            flex: 1;
        }

        .qr-card-right {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qr-name {
            font-size: calc(20px * var(--card-font-scale, 1));
            margin-bottom: 3px;
            line-height: 1.2;
        }

        .qr-role {
            font-size: calc(12px * var(--card-font-scale, 1));
            margin-bottom: 4px;
            line-height: 1.25;
        }

        .qr-intro {
            font-size: calc(11px * var(--card-font-scale, 1));
            margin-bottom: 6px;
            line-height: 1.35;
        }

        .qr-contact-list {
            font-size: calc(10px * var(--card-font-scale, 1));
            line-height: 1.5;
        }

        .qr-contact-item {
            margin-bottom: 1px;
            overflow-wrap: anywhere;
            word-break: break-word;
        }

        .qr-social-list {
            margin-top: 3px;
        }

        .qr-social-icon {
            margin-right: 4px;
            font-size: calc(12px * var(--card-font-scale, 1));
        }

        .qr-code-box {
            width: 150px;
            height: 150px;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .qr-code-box canvas,
        .qr-code-box img {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        .qr-scan-text {
            font-size: calc(11px * var(--card-font-scale, 1));
            line-height: 1.2;
            margin: 0;
        }

        .custom-card-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .sticker-item {
            position: absolute;
            white-space: nowrap;
            cursor: move;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        .sticker-item.dragging {
            opacity: 0.8;
            z-index: 1000;
        }

        .export-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-theme .export-buttons {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .btn-export {
            flex: 1;
            min-width: 100px;
            padding: 14px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .btn-export:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
        }

        .btn-export:active {
            transform: translateY(-1px);
        }

        .btn-export.alt {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.2);
        }

        .btn-export.alt:hover {
            box-shadow: 0 12px 24px rgba(245, 87, 108, 0.4);
        }

        body.light-theme .btn-export {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.light-theme .btn-export.alt {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            margin: 20px 0;
        }

        body.light-theme .divider {
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.1), transparent);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .file-input-label {
            display: block;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            color: #b0b0b0;
            transition: all 0.3s ease;
        }

        body.light-theme .file-input-label {
            background: #f9f9f9;
            border: 2px dashed #ddd;
            color: #666;
        }

        .file-input-label:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        body.light-theme .file-input-label:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 12px;
        }

        body.light-theme .tabs {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .tab {
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: #b0b0b0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        body.light-theme .tab {
            color: #666;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #e0e0e0;
        }

        body.light-theme .tab:hover {
            color: #333;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .preset-btn {
            aspect-ratio: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
        }

        body.light-theme .preset-btn {
            border: 1px solid #ddd;
        }

        .preset-btn:hover,
        .preset-btn.active {
            border-color: #667eea;
            box-shadow: 0 0 16px rgba(102, 126, 234, 0.3);
        }

        .card-type-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .card-type-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #b0b0b0;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        body.light-theme .card-type-btn {
            background: #f5f5f5;
            border: 2px solid #ddd;
            color: #666;
        }

        .card-type-btn:hover {
            border-color: #667eea;
        }

        .card-type-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: #fff;
        }

        .sticker-style-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .sticker-style-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #b0b0b0;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        body.light-theme .sticker-style-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #666;
        }

        .sticker-style-btn:hover {
            border-color: #667eea;
        }

        .sticker-style-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: #fff;
        }

        .sticker-editor {
            padding: 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        body.light-theme .sticker-editor {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid #e0e0e0;
        }

        .sticker-header {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sticker-id {
            font-size: 12px;
            font-weight: 'bold';
            color: '#667eea';
        }

        .btn-delete {
            padding: 4px 8px;
            background: '#ff6348';
            color: '#fff';
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 'bold';
        }

        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 420px 1fr;
            }

            .card-wrapper {
                width: 450px;
                height: 270px;
            }

            .github-link {
                display: none;
            }
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                min-height: 100vh;
            }

            .control-panel {
                grid-row: 1;
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                border-top: none;
                max-height: auto;
                min-height: auto;
                overflow-y: auto;
            }

            .preview-panel {
                grid-row: 2;
                width: 100%;
                max-height: 100%;
                padding: 16px 15px;
                min-height: auto;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                gap: 16px;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .panel-header h1 {
                width: 100%;
                font-size: 18px;
                line-height: 1.2;
            }

            .header-controls {
                width: 100%;
                display: grid;
                grid-template-columns: auto 1fr auto auto;
                gap: 8px;
                align-items: center;
            }

            .lang-selector {
                width: 100%;
                min-width: 0;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-rows: auto 1fr;
                min-height: 100vh;
            }

            .control-panel {
                grid-row: 1;
                max-height: 40vh;
                overflow-y: auto;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .preview-panel {
                grid-row: 2;
                max-height: 60vh;
                min-height: auto;
                padding: 16px 12px;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                overflow-y: auto;
                position: relative;
                gap: 12px;
            }

            .preview-panel > * {
                flex-shrink: 0;
            }

            .animation-controls {
                position: relative !important;
                top: auto !important;
                right: auto !important;
                margin: 0 !important;
                width: auto !important;
                display: flex !important;
                justify-content: center !important;
                gap: 8px !important;
                background: transparent !important;
                padding: 0 !important;
                box-shadow: none !important;
                z-index: auto !important;
                order: 1;
            }

            .panel-content {
                padding: 16px;
            }

            .card-wrapper {
                width: 100%;
                max-width: 300px;
                height: auto;
                aspect-ratio: 16 / 10;
                min-height: 188px;
                margin: 0;
                order: 2;
                overflow: hidden;
            }

            .main-card-wrapper {
                overflow: hidden;
            }

            .main-card-left {
                width: 90px;
                padding: 12px;
            }

            .main-card-right {
                padding: 12px;
                font-size: 11px;
            }

            .main-card-right h2 {
                font-size: 14px;
                margin-bottom: 2px !important;
                word-break: break-word;
                line-height: 1.2;
            }

            .main-card-right p {
                font-size: 9px;
                margin-bottom: 1px !important;
                word-break: break-word;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 1;
                line-clamp: 1;
                -webkit-box-orient: vertical;
            }

            .card-avatar {
                width: 70px;
                height: 70px;
            }

            .qr-card-wrapper {
                padding: 12px;
                flex-direction: column;
                gap: 8px;
                overflow: hidden;
                align-items: stretch;
                justify-content: flex-start;
                max-width: 320px;
            }

            .qr-card-wrapper {
                padding: 12px;
                flex-direction: column;
                gap: 8px;
                overflow: hidden;
                align-items: stretch;
                justify-content: flex-start;
                max-width: 320px;
            }

            .qr-card-left {
                flex: 0;
                min-width: 0;
                overflow: hidden;
                width: 100%;
            }

            /* 强制所有元素的 font-size */
            .qr-card-left h2 {
                font-size: calc(13px * var(--card-font-scale, 1)) !important;
                margin-bottom: 2px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            .qr-card-left > p {
                font-size: calc(9px * var(--card-font-scale, 1)) !important;
                margin-bottom: 2px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            /* 联系信息容器 - 最重要的覆盖 */
            .qr-card-left > div[style*="fontSize"] {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left > div[style*="fontSize"] p {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                margin-bottom: 1px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            .qr-card-left > div[style*="fontSize"] span {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                word-break: break-word !important;
            }

            /* 备用通配符选择器 */
            .qr-card-left > div > p {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                margin-bottom: 1px !important;
                word-break: break-word !important;
            }

            .qr-card-left > div > span {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
            }

            /* 所有文本元素启用换行 */
            .qr-card-left * {
                word-break: break-word !important;
                overflow-wrap: break-word !important;
                white-space: normal !important;
            }

            .qr-card-right {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            #qr-code {
                width: 120px !important;
                height: 120px !important;
                padding: 8px !important;
                flex-shrink: 0 !important;
                margin-bottom: 6px !important;
            }

            .qr-card-right p {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                margin: 0 !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            /* 绝对覆盖所有可能的 inline style font-size */
            .qr-card-left h2[style*="fontSize"] {
                font-size: calc(13px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left p[style*="fontSize"] {
                font-size: calc(9px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left > div[style*="fontSize"] {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
            }

            #qr-code[style*="padding"] {
                padding: 8px !important;
            }

            .qr-card-right p[style*="fontSize"] {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
            }

            .preview-container {
                margin: 0;
                padding: 0;
                width: 100%;
                display: flex;
                justify-content: center;
                order: 2;
            }

            .export-buttons {
                flex-wrap: wrap;
                gap: 6px;
                width: 100%;
                max-width: 320px;
                margin: 0;
                padding: 0;
                border-top: none;
                position: relative;
                z-index: 10;
                order: 3;
                justify-content: center;
            }

            .export-buttons .btn-export {
                flex: 1 1 45%;
                font-size: 12px;
                padding: 8px 6px;
                min-width: 70px;
            }

            .section {
                margin-bottom: 20px;
            }

            .app-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .tab-buttons {
                width: 100%;
            }

            .tab-buttons button {
                flex: 1;
                font-size: 12px;
                padding: 8px 6px;
            }
        }

        @media (max-width: 480px) {
            .panel-header {
                padding: 14px;
            }

            .panel-header h1 {
                font-size: 16px;
            }

            .header-controls {
                grid-template-columns: auto 1fr;
                grid-auto-rows: 36px;
            }

            .header-controls .github-link {
                width: 100%;
            }

            .control-panel {
                grid-row: 1;
                max-height: 40vh;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .preview-panel {
                grid-row: 2;
                max-height: 60vh;
                padding: 12px 8px;
                min-height: auto;
                gap: 12px;
            }

            .panel-content {
                padding: 12px;
            }

            .card-wrapper {
                max-width: 280px;
                height: auto;
                aspect-ratio: 16 / 10;
                min-height: 175px;
                margin: 0;
                overflow: hidden;
            }

            .main-card-left {
                width: 80px;
                padding: 10px;
            }

            .main-card-right {
                padding: 10px;
                font-size: 10px;
            }

            .main-card-right h2 {
                font-size: 12px;
                margin-bottom: 2px !important;
                word-break: break-word;
                line-height: 1.1;
            }

            .main-card-right p {
                font-size: 8px;
                margin-bottom: 1px !important;
                word-break: break-word;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 1;
                line-clamp: 1;
                -webkit-box-orient: vertical;
            }

            .card-avatar {
                width: 60px;
                height: 60px;
            }

            .qr-card-wrapper {
                padding: 10px;
                flex-direction: column;
                gap: 6px;
                overflow: hidden;
                align-items: stretch;
                justify-content: flex-start;
                max-width: 300px;
            }

            .qr-card-left {
                flex: 0;
                min-width: 0;
                overflow: hidden;
                width: 100%;
            }

            /* 强制所有元素的 font-size */
            .qr-card-left h2 {
                font-size: calc(12px * var(--card-font-scale, 1)) !important;
                margin-bottom: 2px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            .qr-card-left > p {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                margin-bottom: 2px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            /* 联系信息容器 - 最重要的覆盖 */
            .qr-card-left > div[style*="fontSize"] {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left > div[style*="fontSize"] p {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
                margin-bottom: 1px !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            .qr-card-left > div[style*="fontSize"] span {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
                word-break: break-word !important;
            }

            /* 备用通配符选择器 */
            .qr-card-left > div > p {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
                margin-bottom: 1px !important;
                word-break: break-word !important;
            }

            .qr-card-left > div > span {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
            }

            /* 所有文本元素启用换行 */
            .qr-card-left * {
                word-break: break-word !important;
                overflow-wrap: break-word !important;
                white-space: normal !important;
            }

            .qr-card-right {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            #qr-code {
                width: 100px !important;
                height: 100px !important;
                padding: 6px !important;
                flex-shrink: 0 !important;
                margin-bottom: 4px !important;
            }

            .qr-card-right p {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
                margin: 0 !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            .qr-card-left h2 {
                font-size: calc(12px * var(--card-font-scale, 1)) !important;
                margin-bottom: 2px !important;
                word-break: break-word !important;
            }

            .qr-card-left > p {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
                margin-bottom: 1px !important;
                overflow: hidden !important;
                word-break: break-word !important;
                line-height: 1.2 !important;
            }

            #qr-code {
                width: 100px !important;
                height: 100px !important;
                padding: 6px !important;
                flex-shrink: 0 !important;
            }

            .qr-card-right p {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
                margin: 3px 0 0 0 !important;
                word-break: break-word !important;
            }

            /* 绝对覆盖所有可能的 inline style font-size (480px) */
            .qr-card-left h2[style*="fontSize"] {
                font-size: calc(12px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left p[style*="fontSize"] {
                font-size: calc(8px * var(--card-font-scale, 1)) !important;
            }

            .qr-card-left > div[style*="fontSize"] {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
            }

            #qr-code[style*="padding"] {
                padding: 6px !important;
            }

            .qr-card-right p[style*="fontSize"] {
                font-size: calc(7px * var(--card-font-scale, 1)) !important;
            }

            .preview-container {
                margin: 0;
                padding: 0;
                width: 100%;
                display: flex;
                justify-content: center;
            }

            .export-buttons {
                margin: 0;
                padding: 0;
                position: relative;
                z-index: 10;
                max-width: 290px;
                width: 100%;
                justify-content: center;
            }

            .section-title {
                font-size: 13px;
            }

            .control-label {
                font-size: 11px;
            }

            .slider-wrapper input[type="range"] {
                height: 4px;
            }

            .control-select,
            .control-input {
                font-size: 12px;
                padding: 8px;
            }

            h1 {
                font-size: 18px !important;
            }
        }

        @media (max-width: 768px) {
            .qr-card-wrapper {
                flex-direction: row !important;
                align-items: stretch !important;
                justify-content: space-between !important;
                padding: 10px !important;
                gap: 8px !important;
                max-width: 100% !important;
            }

            .qr-card-left {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                overflow: hidden !important;
            }

            .qr-card-right {
                flex: 0 0 auto !important;
                width: auto !important;
                justify-content: center !important;
            }

            .qr-name {
                font-size: 14px !important;
                margin-bottom: 2px !important;
            }

            .qr-role {
                font-size: 10px !important;
                margin-bottom: 3px !important;
            }

            .qr-intro {
                font-size: 9px !important;
                margin-bottom: 4px !important;
                line-height: 1.25 !important;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .qr-contact-list {
                font-size: 8px !important;
                line-height: 1.25 !important;
            }

            .qr-contact-item {
                margin-bottom: 1px !important;
                line-height: 1.2 !important;
            }

            .qr-social-icon {
                font-size: 10px !important;
            }

            .qr-code-box {
                width: 96px !important;
                height: 96px !important;
                padding: 6px !important;
                margin-bottom: 4px !important;
            }

            #qr-code {
                width: 96px !important;
                height: 96px !important;
                padding: 6px !important;
                margin-bottom: 4px !important;
            }

            .qr-scan-text {
                font-size: 8px !important;
            }
        }

        @media (max-width: 480px) {
            .qr-card-wrapper {
                flex-direction: row !important;
                align-items: stretch !important;
                justify-content: space-between !important;
                padding: 8px !important;
                gap: 6px !important;
                max-width: 100% !important;
            }

            .qr-card-left {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                overflow: hidden !important;
            }

            .qr-card-right {
                flex: 0 0 auto !important;
                width: auto !important;
                justify-content: center !important;
            }

            .qr-name {
                font-size: 12px !important;
            }

            .qr-role {
                font-size: 9px !important;
            }

            .qr-intro {
                font-size: 8px !important;
            }

            .qr-contact-list {
                font-size: 7px !important;
            }

            .qr-social-icon {
                font-size: 9px !important;
            }

            .qr-code-box {
                width: 78px !important;
                height: 78px !important;
                padding: 5px !important;
                margin-bottom: 3px !important;
            }

            #qr-code {
                width: 78px !important;
                height: 78px !important;
                padding: 5px !important;
                margin-bottom: 3px !important;
            }

            .qr-scan-text {
                font-size: 7px !important;
            }
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "數位名片製作 - 線上免費工具",
      "description": "快速創建專業的電子名片和數位明信片，支援PNG、JPG、WebP、HTML和vCard格式匯出。無需設計經驗，即可製作高質感的數位名信片。",
    "url": "https://lian0123.github.io/virtual-business-card-project/",
    "image": "https://lian0123.github.io/virtual-business-card-project/public/icons/icon-512.png",
      "applicationCategory": "BusinessApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
            "inLanguage": ["zh-TW", "zh-CN", "en-US", "ja-JP", "ko-KR", "vi-VN", "fr-FR", "de-DE", "es-ES", "pt-PT", "id-ID", "ru-RU", "pl-PL", "tr-TR", "ar"],
            "sameAs": [
                "https://github.com/Lian0123/virtual-business-card-project",
                "https://lian0123.github.io/virtual-business-card-project/webmcp-example.html"
            ],
      "author": {
        "@type": "Organization",
        "name": "Virtual Card Maker"
      }
    }
    </script>
</head>
<body class="dark-theme">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const STICKER_STYLES = {
            text: { label: 'stickerStyleText' },
            shadow: { label: 'stickerStyleShadow' },
            outline: { label: 'stickerStyleOutline' },
            bold: { label: 'stickerStyleBold' },
            italic: { label: 'stickerStyleItalic' },
            glow: { label: 'stickerStyleGlow' }
        };

        const CARD_TEMPLATES = {
            professional: {
                name: '專業風格',
                bgImage: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                colors: {
                    primary: '#667eea',
                    secondary: '#764ba2',
                    accent: '#f093fb'
                }
            },
            modern: {
                name: '現代風格',
                bgImage: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                colors: {
                    primary: '#f093fb',
                    secondary: '#f5576c',
                    accent: '#4facfe'
                }
            },
            minimal: {
                name: '極簡風格',
                bgImage: 'linear-gradient(135deg, #667eea 0%, #667eea 100%)',
                colors: {
                    primary: '#333333',
                    secondary: '#666666',
                    accent: '#999999'
                }
            },
            vibrant: {
                name: '活力風格',
                bgImage: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                colors: {
                    primary: '#4facfe',
                    secondary: '#00f2fe',
                    accent: '#43e97b'
                }
            },
            sunset: {
                name: '日落風格',
                bgImage: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                colors: {
                    primary: '#fa709a',
                    secondary: '#fee140',
                    accent: '#ff6348'
                }
            },
            ocean: {
                name: '海洋風格',
                bgImage: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)',
                colors: {
                    primary: '#1e3c72',
                    secondary: '#2a5298',
                    accent: '#00d4ff'
                }
            },
            forest: {
                name: '森林風格',
                bgImage: 'linear-gradient(135deg, #134e5e 0%, #71b280 100%)',
                colors: {
                    primary: '#134e5e',
                    secondary: '#71b280',
                    accent: '#90ee90'
                }
            },
            aurora: {
                name: '極光風格',
                bgImage: 'linear-gradient(135deg, #00c9ff 0%, #92fe9d 100%)',
                colors: {
                    primary: '#00c9ff',
                    secondary: '#92fe9d',
                    accent: '#5f72ff'
                }
            },
            midnight: {
                name: '午夜風格',
                bgImage: 'linear-gradient(135deg, #232526 0%, #414345 100%)',
                colors: {
                    primary: '#232526',
                    secondary: '#414345',
                    accent: '#00c6ff'
                }
            },
            peach: {
                name: '蜜桃風格',
                bgImage: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                colors: {
                    primary: '#ff8a65',
                    secondary: '#fcb69f',
                    accent: '#ff7043'
                }
            },
            royal: {
                name: '皇家風格',
                bgImage: 'linear-gradient(135deg, #141e30 0%, #243b55 100%)',
                colors: {
                    primary: '#243b55',
                    secondary: '#141e30',
                    accent: '#c9a227'
                }
            },
            lava: {
                name: '熔岩風格',
                bgImage: 'linear-gradient(135deg, #f12711 0%, #f5af19 100%)',
                colors: {
                    primary: '#f12711',
                    secondary: '#f5af19',
                    accent: '#8a2387'
                }
            }
        };

        const TEMPLATE_LABEL_KEYS = {
            professional: 'templateProfessional',
            modern: 'templateModern',
            minimal: 'templateMinimal',
            vibrant: 'templateVibrant',
            sunset: 'templateSunset',
            ocean: 'templateOcean',
            forest: 'templateForest',
            aurora: 'templateAurora',
            midnight: 'templateMidnight',
            peach: 'templatePeach',
            royal: 'templateRoyal',
            lava: 'templateLava'
        };

        const LANGUAGES = {
            'zh-TW': { name: '繁體中文', flag: '🇹🇼' },
            'en-US': { name: 'English', flag: '🇺🇸' },
            'ja-JP': { name: '日本語', flag: '🇯🇵' },
            'th-TH': { name: 'ไทย', flag: '🇹🇭' },
            'ko-KR': { name: '한국어', flag: '🇰🇷' },
            'vi-VN': { name: 'Tiếng Việt', flag: '🇻🇳' },
            'fr-FR': { name: 'Français', flag: '🇫🇷' },
            'de-DE': { name: 'Deutsch', flag: '🇩🇪' },
            'es-ES': { name: 'Español', flag: '🇪🇸' },
            'pt-PT': { name: 'Português', flag: '🇵🇹' },
            'id-ID': { name: 'Bahasa Indonesia', flag: '🇮🇩' },
            'ru-RU': { name: 'Русский', flag: '🇷🇺' },
            'pl-PL': { name: 'Polski', flag: '🇵🇱' },
            'tr-TR': { name: 'Türkçe', flag: '🇹🇷' },
            'ar': { name: 'العربية', flag: '🇸🇦' }
        };

        const TRANSLATIONS = {
            'zh-TW': {
                title: '專業名片製作',
                cardType: '名片類型',
                avatar: '頭像',
                avatarShape: '頭像形狀',
                circular: '圓形',
                square: '方形',
                roundedSquare: '圓角方形',
                previewBgColor: '背景顏色',
                previewPattern: '背景圖案',
                patternOpacity: '圖案透明度',
                patternScale: '圖案縮放',
                patternRotation: '圖案旋轉',
                filters: '濾鏡效果',
                lighting: '光影效果',
                export: '匯出',
                animation: '動畫效果',
                animationDuration: '動畫時間（秒）',
                animationDelay: '動畫延遲（秒）',
                animationType: '動畫類型',
                animationLoops: '動畫循環',
                socialMedia: '社交媒體',
                addSocialLink: '添加社交媒體',
                decoration: '裝飾元素',
                lineStyle: '線條樣式',
                solid: '實線',
                dashed: '虛線',
                dotted: '點線',
                cornerDecoration: '角落裝飾',
                layoutSettings: '資訊顯示',
                showAddress: '顯示地址',
                showIntro: '顯示自我介紹',
                showWebsite: '顯示網站',
                showEmail: '顯示信箱',
                showPhone: '顯示電話',
                showSocial: '顯示社交媒體',
                showCountryFlag: '顯示國旗',
                ctaSettings: '行動號召',
                ctaLabel: '按鈕文字',
                ctaUrl: '按鈕連結',
                ctaStyle: '按鈕風格',
                basicSettings: '基本設定',
                advancedSettings: '進階控制',
                nameLabel: '姓名',
                titleLabel: '職稱',
                companyLabel: '公司',
                countryLabel: '國家/地區',
                addressLabel: '地址',
                emailLabel: '郵箱',
                phoneLabel: '電話',
                websiteLabel: '網站',
                introLabel: '自我介紹',
                uploadAvatar: '上傳頭像',
                avatarUploaded: '✓ 已上傳',
                clickUploadAvatar: '📤 點擊上傳頭像',
                basicInfo: '基本資訊',
                innerRadius: '內框圓角半徑',
                qrSettings: 'QR CODE 設定',
                qrContentHint: 'QR Code 內容（留空自動生成）',
                qrContentPlaceholder: '留空則自動生成聯絡資訊',
                customCardTitle: '自定義名片',
                bgColorLabel: '背景顏色',
                textColorLabel: '文字顏色',
                uploadBgLabel: '上傳背景圖片',
                clickUploadBg: '📤 點擊上傳背景圖片',
                bgUploaded: '✓ 已上傳',
                addTextStickerBtn: '+ 添加文字貼圖',
                addImageStickerBtn: '+ 添加圖片貼圖',
                designTemplate: '設計範本',
                gradientControl: '漸層色彩控制',
                gradientColor1: '漸層色彩 1',
                gradientColor2: '漸層色彩 2',
                shadowControl: '陰影控制',
                horizontalShift: '水平位移',
                verticalShift: '垂直位移',
                blurDegree: '模糊程度',
                shadowColorLabel: '陰影顏色',
                filterTypeLabel: '濾鏡類型',
                filterNone: '無',
                filterBlur: '模糊',
                filterGrayscale: '灰階',
                filterInvert: '反相',
                filterSepia: '懷舊',
                filterIntensity: '濾鏡強度',
                lightingTypeLabel: '光影類型',
                lightingNone: '無',
                lightingShadow: '陰影',
                lightingGlow: '光暈',
                lightingIntensity: '光影強度',
                visualAdjust: '視覺調整',
                brightnessLabel: '亮度',
                contrastLabel: '對比度',
                saturationLabel: '飽和度',
                hueLabel: '色相',
                sharpnessLabel: '銳化',
                blurLabel: '模糊',
                borderControl: '圓角控制',
                outerRadius: '外框圓角半徑',
                fontAnimation: '字體與動畫',
                fontLabel: '字體',
                baseFontSize: '基礎字體大小',
                borderMode: '卡片邊框模式',
                solidColor: '純色',
                gradientBorder: '漸層',
                borderColorLabel: '卡片邊框顏色',
                borderGradient1: '邊框漸層色彩 1',
                borderGradient2: '邊框漸層色彩 2',
                borderWidthLabel: '卡片邊框寬度',
                infiniteLoop: '無限',
                onceLoop: '一次',
                threeTimesLoop: '3次',
                bgPatternTitle: '背景圖案',
                patternNone: '無',
                patternDots: '圓點',
                patternGrid: '網格',
                patternLines: '線條',
                patternWaves: '波浪',
                patternDiagonal: '對角線',
                patternCheckered: '棋盤',
                patternMesh: '網狀',
                patternSprinkles: '灑點',
                selectDecorationLabel: '選擇裝飾元素',
                freeDecorationTitle: '自由定位裝飾',
                addDecorationBtn: '新增裝飾',
                scanToContact: '掃描以聯繫',
                mainLabel: '主要',
                qrLabel: 'QR CODE',
                customLabel: '自定義',
                xPositionLabel: 'X 位置',
                yPositionLabel: 'Y 位置',
                sizeLabel: '大小',
                colorLabel: '顏色',
                opacityLabel: '不透明度',
                rotationLabel: '旋轉',
                widthLabel: '寬度',
                heightLabel: '高度',
                elementSelectLabel: '元素',
                deleteLabel: '刪除',
                stickerLabel: '貼圖',
                imagePreview: '圖片預覽',
                stickerStyle: '貼圖樣式',
                textContent: '文字內容',
                patternOpacityLabel: '圖案不透明度',
                patternScaleLabel: '圖案縮放',
                exportPng: '匯出 PNG',
                exportJpg: '匯出 JPG',
                exportWebp: '匯出 WebP',
                exportHtml: '匯出 HTML',
                exportVcf: '匯出 VCF',
                pauseAnimation: '暫停動畫',
                playAnimation: '播放動畫',
                replayAnimation: '重新播放',
                stickerStyleText: '純文字',
                stickerStyleShadow: '陰影',
                stickerStyleOutline: '描邊',
                stickerStyleBold: '粗體',
                stickerStyleItalic: '斜體',
                stickerStyleGlow: '發光',
                animationNone: '無',
                animationFadeIn: '淡入',
                animationSlideLeft: '從左滑入',
                animationSlideRight: '從右滑入',
                animationSlideUp: '從下滑入',
                animationSlideDown: '從上滑入',
                animationZoomIn: '放大進入',
                animationBounceIn: '彈跳進入',
                animationRotateIn: '旋轉進入',
                animationFlip: '翻轉',
                animationPulse: '脈動',
                animationSwing: '搖晃',
                animationWobble: '擺動',
                animationJello: '果凍抖動',
                decorativeLine1: '水平線',
                decorativeLine2: '虛線',
                decorativeLine3: '點線',
                decorativeWave: '波線',
                decorativeCorner1: '角落裝飾1',
                decorativeCorner2: '角落裝飾2',
                decorativeCorner3: '角落裝飾3',
                decorativeStar: '星形',
                decorativeHeart: '心形',
                decorativeCircle: '圓形',
                decorativeTriangle: '三角形',
                decorativeDiamond: '菱形',
                decorativeFlower: '花形',
                decorativeSpark: '閃光',
                decorativeLeaf: '葉子',
                decorativeGear: '齒輪',
                decorativeRibbon: '絲帶邊框',
                decorativeSunburst: '光芒',
                decorativeZigzag: '鋸齒線',
                decorativeBrackets: '括號角',
                decorativeHexagon: '六角',
                decorativeSparkle: '星火',
                decorativeDottrail: '點陣',
                colorPresetsLabel: '色彩快速預設',
                githubProject: 'GitHub 專案',
                githubUser: 'GitHub 使用者',
                templateProfessional: '專業風格',
                templateModern: '現代風格',
                templateMinimal: '極簡風格',
                templateVibrant: '活力風格',
                templateSunset: '日落風格',
                templateOcean: '海洋風格',
                templateForest: '森林風格',
                templateAurora: '極光風格',
                templateMidnight: '午夜風格',
                templatePeach: '蜜桃風格',
                templateRoyal: '皇家風格',
                templateLava: '熔岩風格'
            },
            'en-US': {
                title: 'Professional Business Card',
                cardType: 'Card Type',
                avatar: 'Avatar',
                avatarShape: 'Avatar Shape',
                circular: 'Circular',
                square: 'Square',
                roundedSquare: 'Rounded Square',
                previewBgColor: 'Background Color',
                previewPattern: 'Background Pattern',
                patternOpacity: 'Pattern Opacity',
                patternScale: 'Pattern Scale',
                patternRotation: 'Pattern Rotation',
                filters: 'Filters',
                lighting: 'Lighting',
                export: 'Export',
                animation: 'Animation Effects',
                animationDuration: 'Animation Duration (seconds)',
                animationDelay: 'Animation Delay (seconds)',
                animationType: 'Animation Type',
                animationLoops: 'Animation Loops',
                socialMedia: 'Social Media',
                addSocialLink: 'Add Social Media',
                decoration: 'Decorative Elements',
                lineStyle: 'Line Style',
                solid: 'Solid',
                dashed: 'Dashed',
                dotted: 'Dotted',
                cornerDecoration: 'Corner Decoration',
                layoutSettings: 'Display Options',
                showAddress: 'Show Address',
                showIntro: 'Show Bio',
                showWebsite: 'Show Website',
                showEmail: 'Show Email',
                showPhone: 'Show Phone',
                showSocial: 'Show Social Links',
                showCountryFlag: 'Show Country Flag',
                ctaSettings: 'Call To Action',
                ctaLabel: 'Button Label',
                ctaUrl: 'Button Link',
                ctaStyle: 'Button Style',
                basicSettings: 'Basic Settings',
                advancedSettings: 'Advanced',
                nameLabel: 'Name',
                titleLabel: 'Title',
                companyLabel: 'Company',
                countryLabel: 'Country/Region',
                addressLabel: 'Address',
                emailLabel: 'Email',
                phoneLabel: 'Phone',
                websiteLabel: 'Website',
                introLabel: 'Bio',
                uploadAvatar: 'Upload Avatar',
                avatarUploaded: '✓ Uploaded',
                clickUploadAvatar: '📤 Click to upload',
                basicInfo: 'Basic Info',
                innerRadius: 'Inner Border Radius',
                qrSettings: 'QR CODE Settings',
                qrContentHint: 'QR Content (auto-generate if empty)',
                qrContentPlaceholder: 'Leave empty for auto contact info',
                customCardTitle: 'Custom Card',
                bgColorLabel: 'Background Color',
                textColorLabel: 'Text Color',
                uploadBgLabel: 'Upload Background',
                clickUploadBg: '📤 Click to upload background',
                bgUploaded: '✓ Uploaded',
                addTextStickerBtn: '+ Add Text Sticker',
                addImageStickerBtn: '+ Add Image Sticker',
                designTemplate: 'Design Templates',
                gradientControl: 'Gradient Control',
                gradientColor1: 'Gradient Color 1',
                gradientColor2: 'Gradient Color 2',
                shadowControl: 'Shadow Control',
                horizontalShift: 'Horizontal Offset',
                verticalShift: 'Vertical Offset',
                blurDegree: 'Blur Level',
                shadowColorLabel: 'Shadow Color',
                filterTypeLabel: 'Filter Type',
                filterNone: 'None',
                filterBlur: 'Blur',
                filterGrayscale: 'Grayscale',
                filterInvert: 'Invert',
                filterSepia: 'Sepia',
                filterIntensity: 'Filter Intensity',
                lightingTypeLabel: 'Lighting Type',
                lightingNone: 'None',
                lightingShadow: 'Shadow',
                lightingGlow: 'Glow',
                lightingIntensity: 'Lighting Intensity',
                visualAdjust: 'Visual Adjustments',
                brightnessLabel: 'Brightness',
                contrastLabel: 'Contrast',
                saturationLabel: 'Saturation',
                hueLabel: 'Hue',
                sharpnessLabel: 'Sharpness',
                blurLabel: 'Blur',
                borderControl: 'Border Radius',
                outerRadius: 'Outer Radius',
                fontAnimation: 'Font & Animation',
                fontLabel: 'Font',
                baseFontSize: 'Base Font Size',
                borderMode: 'Border Mode',
                solidColor: 'Solid',
                gradientBorder: 'Gradient',
                borderColorLabel: 'Border Color',
                borderGradient1: 'Border Gradient 1',
                borderGradient2: 'Border Gradient 2',
                borderWidthLabel: 'Border Width',
                infiniteLoop: 'Infinite',
                onceLoop: 'Once',
                threeTimesLoop: '3x',
                bgPatternTitle: 'Background Pattern',
                patternNone: 'None',
                patternDots: 'Dots',
                patternGrid: 'Grid',
                patternLines: 'Lines',
                patternWaves: 'Waves',
                patternDiagonal: 'Diagonal',
                patternCheckered: 'Checkered',
                patternMesh: 'Mesh',
                patternSprinkles: 'Sprinkles',
                selectDecorationLabel: 'Select Decorations',
                freeDecorationTitle: 'Free Position Decorations',
                addDecorationBtn: 'Add Decoration',
                scanToContact: 'Scan to Contact',
                mainLabel: 'Main',
                qrLabel: 'QR CODE',
                customLabel: 'Custom',
                xPositionLabel: 'X Position',
                yPositionLabel: 'Y Position',
                sizeLabel: 'Size',
                colorLabel: 'Color',
                opacityLabel: 'Opacity',
                rotationLabel: 'Rotation',
                widthLabel: 'Width',
                heightLabel: 'Height',
                elementSelectLabel: 'Element',
                deleteLabel: 'Delete',
                stickerLabel: 'Sticker',
                imagePreview: 'Preview',
                stickerStyle: 'Sticker Style',
                textContent: 'Text Content',
                patternOpacityLabel: 'Pattern Opacity',
                patternScaleLabel: 'Pattern Scale',
                exportPng: 'Export PNG',
                exportJpg: 'Export JPG',
                exportWebp: 'Export WebP',
                exportHtml: 'Export HTML',
                exportVcf: 'Export VCF',
                pauseAnimation: 'Pause',
                playAnimation: 'Play',
                replayAnimation: 'Replay',
                stickerStyleText: 'Plain Text',
                stickerStyleShadow: 'Shadow',
                stickerStyleOutline: 'Outline',
                stickerStyleBold: 'Bold',
                stickerStyleItalic: 'Italic',
                stickerStyleGlow: 'Glow',
                animationNone: 'None',
                animationFadeIn: 'Fade In',
                animationSlideLeft: 'Slide Left',
                animationSlideRight: 'Slide Right',
                animationSlideUp: 'Slide Up',
                animationSlideDown: 'Slide Down',
                animationZoomIn: 'Zoom In',
                animationBounceIn: 'Bounce In',
                animationRotateIn: 'Rotate In',
                animationFlip: 'Flip',
                animationPulse: 'Pulse',
                animationSwing: 'Swing',
                animationWobble: 'Wobble',
                animationJello: 'Jello',
                decorativeLine1: 'Horizontal Line',
                decorativeLine2: 'Dashed Line',
                decorativeLine3: 'Dotted Line',
                decorativeWave: 'Wave Line',
                decorativeCorner1: 'Corner Decoration 1',
                decorativeCorner2: 'Corner Decoration 2',
                decorativeCorner3: 'Corner Decoration 3',
                decorativeStar: 'Star',
                decorativeHeart: 'Heart',
                decorativeCircle: 'Circle',
                decorativeTriangle: 'Triangle',
                decorativeDiamond: 'Diamond',
                decorativeFlower: 'Flower',
                decorativeSpark: 'Spark',
                decorativeLeaf: 'Leaf',
                decorativeGear: 'Gear',
                decorativeRibbon: 'Ribbon Border',
                decorativeSunburst: 'Sunburst',
                decorativeZigzag: 'Zigzag Line',
                decorativeBrackets: 'Bracket Corner',
                decorativeHexagon: 'Hexagon',
                decorativeSparkle: 'Sparkle',
                decorativeDottrail: 'Dot Pattern',
                colorPresetsLabel: 'Quick Color Presets',
                githubProject: 'GitHub Project',
                githubUser: 'GitHub User',
                templateProfessional: 'Professional',
                templateModern: 'Modern',
                templateMinimal: 'Minimal',
                templateVibrant: 'Vibrant',
                templateSunset: 'Sunset',
                templateOcean: 'Ocean',
                templateForest: 'Forest',
                templateAurora: 'Aurora',
                templateMidnight: 'Midnight',
                templatePeach: 'Peach',
                templateRoyal: 'Royal',
                templateLava: 'Lava'
            },
            'ja-JP': {
                title: 'プロフェッショナル名刺',
                cardType: 'カードタイプ',
                avatar: 'アバター',
                avatarShape: 'アバター形状',
                circular: '円形',
                square: '正方形',
                roundedSquare: '丸角正方形',
                previewBgColor: '背景色',
                previewPattern: '背景パターン',
                patternOpacity: 'パターン不透明度',
                patternScale: 'パターンスケール',
                patternRotation: 'パターン回転',
                filters: 'フィルター',
                lighting: 'ライティング',
                export: 'エクスポート',
                animation: 'アニメーション効果',
                animationDuration: 'アニメーション期間（秒）',
                animationDelay: 'アニメーション遅延（秒）',
                animationType: 'アニメーションタイプ',
                animationLoops: 'アニメーションループ',
                socialMedia: 'ソーシャルメディア',
                addSocialLink: 'ソーシャルメディアを追加',
                decoration: '装飾要素',
                lineStyle: 'ラインスタイル',
                solid: '実線',
                dashed: '破線',
                dotted: '点線',
                cornerDecoration: 'コーナー装飾',
                layoutSettings: '表示設定',
                showAddress: '住所を表示',
                showIntro: '自己紹介を表示',
                showWebsite: 'ウェブサイトを表示',
                showEmail: 'メールを表示',
                showPhone: '電話番号を表示',
                showSocial: 'SNSを表示',
                ctaSettings: 'CTA設定',
                ctaLabel: 'ボタンラベル',
                ctaUrl: 'ボタンリンク',
                ctaStyle: 'ボタンスタイル',
                basicSettings: '基本設定',
                advancedSettings: '詳細設定',
                nameLabel: '名前',
                titleLabel: '役職',
                companyLabel: '会社',
                countryLabel: '国/地域',
                addressLabel: '住所',
                emailLabel: 'メール',
                phoneLabel: '電話',
                websiteLabel: 'ウェブサイト',
                introLabel: '自己紹介',
                uploadAvatar: 'アバターをアップロード',
                avatarUploaded: '✓ アップロード済み',
                clickUploadAvatar: '📤 クリックしてアップロード',
                basicInfo: '基本情報',
                innerRadius: '内枠角丸',
                qrSettings: 'QRコード設定',
                qrContentHint: 'QRコード内容（空欄で自動生成）',
                qrContentPlaceholder: '空欄の場合自動生成',
                customCardTitle: 'カスタムカード',
                bgColorLabel: '背景色',
                textColorLabel: '文字色',
                uploadBgLabel: '背景画像をアップロード',
                clickUploadBg: '📤 背景画像をアップロード',
                bgUploaded: '✓ アップロード済み',
                addTextStickerBtn: '+ テキストステッカー追加',
                addImageStickerBtn: '+ 画像ステッカー追加',
                designTemplate: 'デザインテンプレート',
                gradientControl: 'グラデーション設定',
                gradientColor1: 'グラデーション色 1',
                gradientColor2: 'グラデーション色 2',
                shadowControl: '影設定',
                horizontalShift: '水平オフセット',
                verticalShift: '垂直オフセット',
                blurDegree: 'ぼかし度',
                shadowColorLabel: '影の色',
                filterTypeLabel: 'フィルター種類',
                filterNone: 'なし',
                filterBlur: 'ぼかし',
                filterGrayscale: 'グレースケール',
                filterInvert: '反転',
                filterSepia: 'セピア',
                filterIntensity: 'フィルター強度',
                lightingTypeLabel: 'ライト種類',
                lightingNone: 'なし',
                lightingShadow: '影',
                lightingGlow: '光彩',
                lightingIntensity: 'ライト強度',
                visualAdjust: 'ビジュアル調整',
                brightnessLabel: '明るさ',
                contrastLabel: 'コントラスト',
                saturationLabel: '彩度',
                hueLabel: '色相',
                sharpnessLabel: 'シャープネス',
                blurLabel: 'ぼかし',
                borderControl: '角丸設定',
                outerRadius: '外枠角丸',
                fontAnimation: 'フォントとアニメーション',
                fontLabel: 'フォント',
                baseFontSize: '基本フォントサイズ',
                borderMode: 'ボーダーモード',
                solidColor: '単色',
                gradientBorder: 'グラデーション',
                borderColorLabel: 'ボーダー色',
                borderGradient1: 'ボーダーグラデ 1',
                borderGradient2: 'ボーダーグラデ 2',
                borderWidthLabel: 'ボーダー幅',
                infiniteLoop: '無限',
                onceLoop: '1回',
                threeTimesLoop: '3回',
                bgPatternTitle: '背景パターン',
                patternNone: 'なし',
                patternDots: 'ドット',
                patternGrid: 'グリッド',
                patternLines: 'ライン',
                patternWaves: 'ウェーブ',
                patternDiagonal: '斜線',
                patternCheckered: 'チェッカー',
                patternMesh: 'メッシュ',
                patternSprinkles: 'スプリンクル',
                selectDecorationLabel: '装飾を選択',
                freeDecorationTitle: '自由配置装飾',
                addDecorationBtn: '装飾追加',
                scanToContact: 'スキャンして連絡',
                mainLabel: 'メイン',
                qrLabel: 'QRコード',
                customLabel: 'カスタム',
                xPositionLabel: 'X 位置',
                yPositionLabel: 'Y 位置',
                sizeLabel: 'サイズ',
                colorLabel: '色',
                opacityLabel: '不透明度',
                rotationLabel: '回転',
                widthLabel: '幅',
                heightLabel: '高さ',
                elementSelectLabel: '要素',
                deleteLabel: '削除',
                stickerLabel: 'ステッカー',
                imagePreview: 'プレビュー',
                stickerStyle: 'ステッカースタイル',
                textContent: 'テキスト',
                patternOpacityLabel: 'パターン不透明度',
                patternScaleLabel: 'パターンスケール',
                exportPng: 'PNGエクスポート',
                exportJpg: 'JPGエクスポート',
                exportWebp: 'WebPエクスポート',
                exportHtml: 'HTMLエクスポート',
                exportVcf: 'VCFエクスポート',
                pauseAnimation: '一時停止',
                playAnimation: '再生',
                replayAnimation: 'リプレイ',
                stickerStyleText: 'プレーンテキスト',
                stickerStyleShadow: '影',
                stickerStyleOutline: 'アウトライン',
                stickerStyleBold: 'ボールド',
                stickerStyleItalic: 'イタリック',
                stickerStyleGlow: 'グロー',
                animationNone: 'なし',
                animationFadeIn: 'フェードイン',
                animationSlideLeft: '左からスライド',
                animationSlideRight: '右からスライド',
                animationSlideUp: '下からスライド',
                animationSlideDown: '上からスライド',
                animationZoomIn: 'ズームイン',
                animationBounceIn: 'バウンスイン',
                animationRotateIn: 'ロテートイン',
                animationFlip: 'フリップ',
                animationPulse: 'パルス',
                animationSwing: 'スイング',
                animationWobble: 'ウォブル',
                animationJello: 'ジェロ',
                decorativeLine1: '水平線',
                decorativeLine2: '破線',
                decorativeLine3: '点線',
                decorativeWave: '波线',
                decorativeCorner1: 'コーナーデコレーション1',
                decorativeCorner2: 'コーナーデコレーション2',
                decorativeCorner3: 'コーナーデコレーション3',
                decorativeStar: '星',
                decorativeHeart: 'ハート',
                decorativeCircle: '円',
                decorativeTriangle: '三角形',
                decorativeDiamond: 'ダイヤモンド',
                decorativeFlower: 'フラワー',
                decorativeSpark: 'スパーク',
                decorativeLeaf: 'リーフ',
                decorativeGear: 'ギア',
                decorativeRibbon: 'リボンボーダー',
                decorativeSunburst: 'サンバースト',
                decorativeZigzag: 'ジグザグ線',
                decorativeBrackets: 'ブラケットコーナー',
                decorativeHexagon: '六角形',
                decorativeSparkle: 'スパークル',
                decorativeDottrail: 'ドットパターン'
            },
            'th-TH': {
                title: 'นามการ์ดมืออาชีพ',
                cardType: 'ประเภทการ์ด',
                avatar: 'อวตาร',
                avatarShape: 'รูปร่างอวตาร',
                circular: 'วงกลม',
                square: 'สี่เหลี่ยม',
                roundedSquare: 'สี่เหลี่ยมมุมมน',
                previewBgColor: 'สีพื้นหลัง',
                previewPattern: 'ลวดลายพื้นหลัง',
                patternOpacity: 'ความทึบของลวดลาย',
                patternScale: 'สเกลลวดลาย',
                patternRotation: 'การหมุนลวดลาย',
                filters: 'ตัวกรอง',
                lighting: 'ผลการให้แสง',
                export: 'ส่งออก',
                animation: 'เอฟเฟกต์การเคลื่อนไหว',
                animationDuration: 'ระยะเวลาการเคลื่อนไหว（วินาที）',
                animationDelay: 'การหน่วงเวลาการเคลื่อนไหว（วินาที）',
                animationType: 'ประเภทการเคลื่อนไหว',
                animationLoops: 'วงการเคลื่อนไหว',
                socialMedia: 'โซเชียลมีเดีย',
                addSocialLink: 'เพิ่มโซเชียลมีเดีย',
                decoration: 'องค์ประกอบตกแต่ง',
                lineStyle: 'รูปแบบเส้น',
                solid: 'เส้นทึบ',
                dashed: 'เส้นประ',
                dotted: 'เส้นจุด',
                cornerDecoration: 'การตกแต่งมุม',
                layoutSettings: 'การแสดงผล',
                showAddress: 'แสดงที่อยู่',
                showIntro: 'แสดงแนะนำตัว',
                showWebsite: 'แสดงเว็บไซต์',
                showEmail: 'แสดงอีเมล',
                showPhone: 'แสดงโทรศัพท์',
                showSocial: 'แสดงโซเชียล',
                ctaSettings: 'ปุ่มกระตุ้นการตัดสินใจ',
                ctaLabel: 'ข้อความบนปุ่ม',
                ctaUrl: 'ลิงก์ปุ่ม',
                ctaStyle: 'สไตล์ปุ่ม',
                basicSettings: 'ตั้งค่าพื้นฐาน',
                advancedSettings: 'ตั้งค่าขั้นสูง',
                nameLabel: 'ชื่อ',
                titleLabel: 'ตำแหน่ง',
                companyLabel: 'บริษัท',
                countryLabel: 'ประเทศ/ภูมิภาค',
                addressLabel: 'ที่อยู่',
                emailLabel: 'อีเมล',
                phoneLabel: 'โทรศัพท์',
                websiteLabel: 'เว็บไซต์',
                introLabel: 'แนะนำตัว',
                uploadAvatar: 'อัปโหลดอวตาร์',
                avatarUploaded: '✓ อัปโหลดแล้ว',
                clickUploadAvatar: '📤 คลิกเพื่ออัปโหลด',
                basicInfo: 'ข้อมูลพื้นฐาน',
                innerRadius: 'รัศมีขอบภายใน',
                qrSettings: 'ตั้งค่า QR โค้ด',
                qrContentHint: 'เนื้อหา QR (อัตโนมัติถ้าเว้นว่าง)',
                qrContentPlaceholder: 'เว้นว่างเพื่อสร้างอัตโนมัติ',
                customCardTitle: 'การ์ดกำหนดเอง',
                bgColorLabel: 'สีพื้นหลัง',
                textColorLabel: 'สีตัวอักษร',
                uploadBgLabel: 'อัปโหลดพื้นหลัง',
                clickUploadBg: '📤 อัปโหลดพื้นหลัง',
                bgUploaded: '✓ อัปโหลดแล้ว',
                addTextStickerBtn: '+ เพิ่มสติกเกอร์ข้อความ',
                addImageStickerBtn: '+ เพิ่มสติกเกอร์รูป',
                designTemplate: 'เทมเพลตออกแบบ',
                gradientControl: 'การควบคุมการไล่สี',
                gradientColor1: 'สีไล่ 1',
                gradientColor2: 'สีไล่ 2',
                shadowControl: 'การควบคุมเงา',
                horizontalShift: 'ออฟเซ็ตแนวนอน',
                verticalShift: 'ออฟเซ็ตแนวตั้ง',
                blurDegree: 'ระดับเบลอ',
                shadowColorLabel: 'สีเงา',
                filterTypeLabel: 'ประเภทตัวกรอง',
                filterNone: 'ไม่มี',
                filterBlur: 'เบลอ',
                filterGrayscale: 'ขาวดำ',
                filterInvert: 'กลับสี',
                filterSepia: 'ซีเปีย',
                filterIntensity: 'ความเข้มตัวกรอง',
                lightingTypeLabel: 'ประเภทแสง',
                lightingNone: 'ไม่มี',
                lightingShadow: 'เงา',
                lightingGlow: 'เรืองแสง',
                lightingIntensity: 'ความเข้มแสง',
                visualAdjust: 'การปรับภาพ',
                brightnessLabel: 'ความสว่าง',
                contrastLabel: 'คอนทราสต์',
                saturationLabel: 'ความอิ่มตัว',
                hueLabel: 'โทนสี',
                sharpnessLabel: 'ความคม',
                blurLabel: 'เบลอ',
                borderControl: 'รัศมีຂอบ',
                outerRadius: 'รัศมีขอบนอก',
                fontAnimation: 'ฟอนต์และแอนิเมชัน',
                fontLabel: 'ฟอนต์',
                baseFontSize: 'ขนาดฟอนต์พื้นฐาน',
                borderMode: 'โหมดขอบ',
                solidColor: 'สีเดียว',
                gradientBorder: 'ไล่สี',
                borderColorLabel: 'สีขอบ',
                borderGradient1: 'ขอบไล่ 1',
                borderGradient2: 'ขอบไล่ 2',
                borderWidthLabel: 'ความกว้างขอบ',
                infiniteLoop: 'ไม่สิ้นสุด',
                onceLoop: '1 ครั้ง',
                threeTimesLoop: '3 ครั้ง',
                bgPatternTitle: 'ลวดลายพื้นหลัง',
                patternNone: 'ไม่มี',
                patternDots: 'จุด',
                patternGrid: 'ตาราง',
                patternLines: 'เส้น',
                patternWaves: 'คลื่น',
                patternDiagonal: 'แนวทแยง',
                patternCheckered: 'ตาหมากรุก',
                patternMesh: 'ตาข่าย',
                patternSprinkles: 'โรยจุด',
                selectDecorationLabel: 'เลือกตกแต่ง',
                freeDecorationTitle: 'ตกแต่งอิสระ',
                addDecorationBtn: 'เพิ่มตกแต่ง',
                scanToContact: 'สแกนเพื่อติดต่อ',
                mainLabel: 'หลัก',
                qrLabel: 'QR โค้ด',
                customLabel: 'กำหนดเอง',
                xPositionLabel: 'ตำแหน่ง X',
                yPositionLabel: 'ตำแหน่ง Y',
                sizeLabel: 'ขนาด',
                colorLabel: 'สี',
                opacityLabel: 'ความทึบ',
                rotationLabel: 'การหมุน',
                widthLabel: 'ความกว้าง',
                heightLabel: 'ความสูง',
                elementSelectLabel: 'องค์ประกอบ',
                deleteLabel: 'ลบ',
                stickerLabel: 'สติกเกอร์',
                imagePreview: 'ตัวอย่าง',
                stickerStyle: 'สไตล์สติกเกอร์',
                textContent: 'เนื้อหาข้อความ',
                patternOpacityLabel: 'ความทึบลวดลาย',
                patternScaleLabel: 'ขนาดลวดลาย',
                exportPng: 'ส่งออก PNG',
                exportJpg: 'ส่งออก JPG',
                exportWebp: 'ส่งออก WebP',
                exportHtml: 'ส่งออก HTML',
                exportVcf: 'ส่งออก VCF',
                pauseAnimation: 'หยุด',
                playAnimation: 'เล่น',
                replayAnimation: 'เล่นซ้ำ',
                stickerStyleText: 'ข้อความธรรมชาติ',
                stickerStyleShadow: 'เงา',
                stickerStyleOutline: 'เส้นขอบ',
                stickerStyleBold: 'ตัวหนา',
                stickerStyleItalic: 'ตัวเอียง',
                stickerStyleGlow: 'เรืองแสง',
                animationNone: 'ไม่มี',
                animationFadeIn: 'ฟেดเข้า',
                animationSlideLeft: 'สไลด์จากซ้าย',
                animationSlideRight: 'สไลด์จากขวา',
                animationSlideUp: 'สไลด์จากล่าง',
                animationSlideDown: 'สไลด์จากด้านบน',
                animationZoomIn: 'ซูมเข้า',
                animationBounceIn: 'เด้งเข้า',
                animationRotateIn: 'หมุนเข้า',
                animationFlip: 'พลิก',
                animationPulse: 'พัลส์',
                animationSwing: 'แกว่ง',
                animationWobble: 'โยก',
                animationJello: 'เจลโล่',
                decorativeLine1: 'เส้นแนวนอน',
                decorativeLine2: 'เส้นประ',
                decorativeLine3: 'เส้นจุด',
                decorativeWave: 'เส้นคลื่น',
                decorativeCorner1: 'ตกแต่งมุม 1',
                decorativeCorner2: 'ตกแต่งมุม 2',
                decorativeCorner3: 'ตกแต่งมุม 3',
                decorativeStar: 'ดาว',
                decorativeHeart: 'หัวใจ',
                decorativeCircle: 'วงกลม',
                decorativeTriangle: 'สามเหลี่ยม',
                decorativeDiamond: 'เพชร',
                decorativeFlower: 'ดอกไม้',
                decorativeSpark: 'ประกายไฟ',
                decorativeLeaf: 'ใบไม้',
                decorativeGear: 'เกียร์',
                decorativeRibbon: 'กรอบริบบิ้น',
                decorativeSunburst: 'แสงแดด',
                decorativeZigzag: 'เส้นซิกแซก',
                decorativeBrackets: 'มุมวงเล็บ',
                decorativeHexagon: 'หกเหลี่ยม',
                decorativeSparkle: 'ปรี่ด',
                decorativeDottrail: 'ลวดลายจุด'
            },
            'ko-KR': {
                title: '전문가용 명함',
                cardType: '카드 종류',
                avatar: '아바타',
                avatarShape: '아바타 모양',
                circular: '원형',
                square: '정사각형',
                roundedSquare: '둥근 모서리',
                previewBgColor: '배경색',
                previewPattern: '배경 패턴',
                patternOpacity: '패턴 불투명도',
                patternScale: '패턴 스케일',
                patternRotation: '패턴 회전',
                filters: '필터',
                lighting: '조명 효과',
                export: '내보내기',
                animation: '애니메이션 효과',
                animationDuration: '애니메이션 기간(초)',
                animationDelay: '애니메이션 지연(초)',
                animationType: '애니메이션 유형',
                animationLoops: '애니메이션 루프',
                socialMedia: '소셜 미디어',
                addSocialLink: '소셜 미디어 추가',
                decoration: '장식 요소',
                lineStyle: '선 스타일',
                solid: '실선',
                dashed: '점선',
                dotted: '점선',
                cornerDecoration: '모서리 장식',
                layoutSettings: '표시 설정',
                showAddress: '주소 표시',
                showIntro: '소개 표시',
                showWebsite: '웹사이트 표시',
                showEmail: '이메일 표시',
                showPhone: '전화번호 표시',
                showSocial: '소셜 링크 표시',
                ctaSettings: 'CTA 설정',
                ctaLabel: '버튼 라벨',
                ctaUrl: '버튼 링크',
                ctaStyle: '버튼 스타일',
                basicSettings: '기본 설정',
                advancedSettings: '고급 설정',
                nameLabel: '이름',
                titleLabel: '직함',
                companyLabel: '회사',
                countryLabel: '국가/지역',
                addressLabel: '주소',
                emailLabel: '이메일',
                phoneLabel: '전화',
                websiteLabel: '웹사이트',
                introLabel: '소개',
                uploadAvatar: '아바타 업로드',
                avatarUploaded: '✓ 업로드 완료',
                clickUploadAvatar: '📤 클릭하여 업로드',
                basicInfo: '기본 정보',
                innerRadius: '내부 테두리 반경',
                qrSettings: 'QR코드 설정',
                qrContentHint: 'QR 코드 내용 (비워두면 자동 생성)',
                qrContentPlaceholder: '비워두면 연락처 자동 생성',
                customCardTitle: '커스텀 카드',
                bgColorLabel: '배경색',
                textColorLabel: '글자색',
                uploadBgLabel: '배경 이미지 업로드',
                clickUploadBg: '📤 배경 업로드',
                bgUploaded: '✓ 업로드 완료',
                addTextStickerBtn: '+ 텍스트 스티커 추가',
                addImageStickerBtn: '+ 이미지 스티커 추가',
                designTemplate: '디자인 템플릿',
                gradientControl: '그라디언트 설정',
                gradientColor1: '그라디언트 색상 1',
                gradientColor2: '그라디언트 색상 2',
                shadowControl: '그림자 설정',
                horizontalShift: '수평 오프셋',
                verticalShift: '수직 오프셋',
                blurDegree: '흐림 정도',
                shadowColorLabel: '그림자 색상',
                filterTypeLabel: '필터 유형',
                filterNone: '없음',
                filterBlur: '흐림',
                filterGrayscale: '흐백',
                filterInvert: '반전',
                filterSepia: '세피아',
                filterIntensity: '필터 강도',
                lightingTypeLabel: '조명 유형',
                lightingNone: '없음',
                lightingShadow: '그림자',
                lightingGlow: '발광',
                lightingIntensity: '조명 강도',
                visualAdjust: '시각적 조정',
                brightnessLabel: '밝기',
                contrastLabel: '대비',
                saturationLabel: '채도',
                hueLabel: '색조',
                sharpnessLabel: '선명도',
                blurLabel: '흐림',
                borderControl: '테두리 설정',
                outerRadius: '외부 테두리 반경',
                fontAnimation: '폰트 및 애니메이션',
                fontLabel: '폰트',
                baseFontSize: '기본 폰트 크기',
                borderMode: '테두리 모드',
                solidColor: '단색',
                gradientBorder: '그라디언트',
                borderColorLabel: '테두리 색상',
                borderGradient1: '테두리 그라디 1',
                borderGradient2: '테두리 그라디 2',
                borderWidthLabel: '테두리 두께',
                infiniteLoop: '무한',
                onceLoop: '1회',
                threeTimesLoop: '3회',
                bgPatternTitle: '배경 패턴',
                patternNone: '없음',
                patternDots: '점',
                patternGrid: '격자',
                patternLines: '선',
                patternWaves: '파도',
                patternDiagonal: '대각선',
                patternCheckered: '체커보드',
                patternMesh: '메쉬',
                patternSprinkles: '스프링클',
                selectDecorationLabel: '장식 선택',
                freeDecorationTitle: '자유 배치 장식',
                addDecorationBtn: '장식 추가',
                scanToContact: '스쮨하여 연락',
                mainLabel: '메인',
                qrLabel: 'QR코드',
                customLabel: '커스텀',
                xPositionLabel: 'X 위치',
                yPositionLabel: 'Y 위치',
                sizeLabel: '크기',
                colorLabel: '색상',
                opacityLabel: '불투명도',
                rotationLabel: '회전',
                widthLabel: '너비',
                heightLabel: '높이',
                elementSelectLabel: '요소',
                deleteLabel: '삭제',
                stickerLabel: '스티커',
                imagePreview: '미리보기',
                stickerStyle: '스티커 스타일',
                textContent: '텍스트',
                patternOpacityLabel: '패턴 불투명도',
                patternScaleLabel: '패턴 스케일',
                exportPng: 'PNG 내보내기',
                exportJpg: 'JPG 내보내기',
                exportWebp: 'WebP 내보내기',
                exportHtml: 'HTML 내보내기',
                exportVcf: 'VCF 내보내기',
                pauseAnimation: '일시정지',
                playAnimation: '재생',
                replayAnimation: '다시 재생',
                stickerStyleText: '순수 텍스트',
                stickerStyleShadow: '그림자',
                stickerStyleOutline: '아웃라인',
                stickerStyleBold: '굵음',
                stickerStyleItalic: '이탤릭',
                stickerStyleGlow: '빛남',
                animationNone: '없음',
                animationFadeIn: '페이드인',
                animationSlideLeft: '왼쪽에서 슬라이드',
                animationSlideRight: '오른쪽에서 슬라이드',
                animationSlideUp: '아래에서 슬라이드',
                animationSlideDown: '위에서 슬라이드',
                animationZoomIn: '줌인',
                animationBounceIn: '튀어 들어옴',
                animationRotateIn: '회전 들어가기',
                animationFlip: '뒤집기',
                animationPulse: '펄스',
                animationSwing: '스윙',
                animationWobble: '흔들기',
                animationJello: '젤로',
                decorativeLine1: '수평선',
                decorativeLine2: '파선',
                decorativeLine3: '점선',
                decorativeWave: '파도선',
                decorativeCorner1: '코너 장식1',
                decorativeCorner2: '코너 장식2',
                decorativeCorner3: '코너 장식3',
                decorativeStar: '별',
                decorativeHeart: '하트',
                decorativeCircle: '원',
                decorativeTriangle: '삼각형',
                decorativeDiamond: '다이아몬드',
                decorativeFlower: '꽃',
                decorativeSpark: '불꽃',
                decorativeLeaf: '잎',
                decorativeGear: '톱니바퀴',
                decorativeRibbon: '리본 테두리',
                decorativeSunburst: '태양광선',
                decorativeZigzag: '지그재그 선',
                decorativeBrackets: '브래킷 코너',
                decorativeHexagon: '육각형',
                decorativeSparkle: '반짝임',
                decorativeDottrail: '점 패턴'
            }
        };

        const buildLocale = (overrides = {}) => ({
            ...TRANSLATIONS['en-US'],
            ...overrides
        });

        TRANSLATIONS['vi-VN'] = buildLocale({
            title: 'Trình Tạo Danh Thiếp Chuyên Nghiệp',
            basicSettings: 'Cài đặt cơ bản',
            advancedSettings: 'Nâng cao',
            designTemplate: 'Mẫu thiết kế',
            countryLabel: 'Quốc gia/Khu vực',
            showCountryFlag: 'Hiển thị cờ quốc gia'
        });

        TRANSLATIONS['fr-FR'] = buildLocale({
            title: 'Créateur de Carte Professionnelle',
            basicSettings: 'Paramètres de base',
            advancedSettings: 'Avancé',
            designTemplate: 'Modèles de design',
            countryLabel: 'Pays/Région',
            showCountryFlag: 'Afficher le drapeau'
        });

        TRANSLATIONS['de-DE'] = buildLocale({
            title: 'Professioneller Visitenkarten-Generator',
            basicSettings: 'Grundeinstellungen',
            advancedSettings: 'Erweitert',
            designTemplate: 'Designvorlagen',
            countryLabel: 'Land/Region',
            showCountryFlag: 'Landesflagge anzeigen'
        });

        TRANSLATIONS['es-ES'] = buildLocale({
            title: 'Creador Profesional de Tarjetas',
            basicSettings: 'Configuración básica',
            advancedSettings: 'Avanzado',
            designTemplate: 'Plantillas de diseño',
            countryLabel: 'País/Región',
            showCountryFlag: 'Mostrar bandera'
        });

        TRANSLATIONS['pt-PT'] = buildLocale({
            title: 'Criador Profissional de Cartões',
            basicSettings: 'Configurações básicas',
            advancedSettings: 'Avançado',
            designTemplate: 'Modelos de design',
            countryLabel: 'País/Região',
            showCountryFlag: 'Mostrar bandeira'
        });

        TRANSLATIONS['id-ID'] = buildLocale({
            title: 'Pembuat Kartu Nama Profesional',
            basicSettings: 'Pengaturan Dasar',
            advancedSettings: 'Lanjutan',
            designTemplate: 'Template Desain',
            countryLabel: 'Negara/Wilayah',
            showCountryFlag: 'Tampilkan bendera negara'
        });

        TRANSLATIONS['ru-RU'] = buildLocale({
            title: 'Профессиональный Конструктор Визиток',
            basicSettings: 'Основные настройки',
            advancedSettings: 'Расширенные',
            designTemplate: 'Шаблоны дизайна',
            countryLabel: 'Страна/Регион',
            showCountryFlag: 'Показывать флаг страны'
        });

        TRANSLATIONS['pl-PL'] = buildLocale({
            title: 'Profesjonalny Kreator Wizytówek',
            basicSettings: 'Ustawienia podstawowe',
            advancedSettings: 'Zaawansowane',
            designTemplate: 'Szablony projektu',
            countryLabel: 'Kraj/Region',
            showCountryFlag: 'Pokaż flagę kraju'
        });

        TRANSLATIONS['tr-TR'] = buildLocale({
            title: 'Profesyonel Kartvizit Oluşturucu',
            basicSettings: 'Temel Ayarlar',
            advancedSettings: 'Gelişmiş',
            designTemplate: 'Tasarım Şablonları',
            countryLabel: 'Ülke/Bölge',
            showCountryFlag: 'Ülke bayrağını göster'
        });

        TRANSLATIONS['ar'] = buildLocale({
            title: 'منشئ بطاقات أعمال احترافي',
            basicSettings: 'الإعدادات الأساسية',
            advancedSettings: 'متقدم',
            designTemplate: 'قوالب التصميم',
            countryLabel: 'الدولة/المنطقة',
            showCountryFlag: 'إظهار علم الدولة'
        });

        const BG_PATTERNS = {
            dots: 'radial-gradient(circle, rgba(255,255,255,0.2) 2px, transparent 2px)',
            grid: 'linear-gradient(0deg, rgba(255,255,255,0.15) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.15) 1px, transparent 1px)',
            lines: 'repeating-linear-gradient(0deg, rgba(255,255,255,0.12) 1px, transparent 1px)',
            waves: 'linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 25%, transparent 50%, rgba(255,255,255,0.2) 75%, transparent 100%)',
            diagonal: 'repeating-linear-gradient(45deg, rgba(255,255,255,0.12) 0px, rgba(255,255,255,0.12) 1px, transparent 1px, transparent 10px)',
            checkered: 'linear-gradient(45deg, rgba(255,255,255,0.12) 25%, transparent 25%), linear-gradient(-45deg, rgba(255,255,255,0.12) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.12) 75%), linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.12) 75%)',
            mesh: 'radial-gradient(circle at 10% 20%, rgba(255,255,255,0.2), transparent 25%), radial-gradient(circle at 80% 0%, rgba(255,255,255,0.15), transparent 35%), radial-gradient(circle at 80% 50%, rgba(255,255,255,0.1), transparent 45%)',
            sprinkles: 'radial-gradient(circle, rgba(255,255,255,0.2) 2px, transparent 2px) 0 0/30px 30px, radial-gradient(circle, rgba(255,255,255,0.08) 1px, transparent 1px) 15px 15px/30px 30px'
        };

        const ANIMATION_OPTIONS = {
            'none': { label: 'animationNone', duration: 1 },
            'fadeIn': { label: 'animationFadeIn', duration: 1 },
            'slideInLeft': { label: 'animationSlideLeft', duration: 1 },
            'slideInRight': { label: 'animationSlideRight', duration: 1 },
            'slideInUp': { label: 'animationSlideUp', duration: 1 },
            'slideInDown': { label: 'animationSlideDown', duration: 1 },
            'zoomIn': { label: 'animationZoomIn', duration: 1 },
            'bounceIn': { label: 'animationBounceIn', duration: 1 },
            'rotateIn': { label: 'animationRotateIn', duration: 1 },
            'flip': { label: 'animationFlip', duration: 1.2 },
            'pulse': { label: 'animationPulse', duration: 2 },
            'swing': { label: 'animationSwing', duration: 1 },
            'wobble': { label: 'animationWobble', duration: 1 },
            'jello': { label: 'animationJello', duration: 0.9 }
        };

        const SOCIAL_MEDIA = {
            facebook: { icon: '📘', name: 'Facebook', color: '#1877F2' },
            twitter: { icon: '🐦', name: 'Twitter/X', color: '#000000' },
            instagram: { icon: '📷', name: 'Instagram', color: '#E4405F' },
            linkedin: { icon: '💼', name: 'LinkedIn', color: '#0A66C2' },
            github: { icon: '🐙', name: 'GitHub', color: '#333333' },
            youtube: { icon: '▶️', name: 'YouTube', color: '#FF0000' },
            tiktok: { icon: '🎵', name: 'TikTok', color: '#000000' },
            whatsapp: { icon: '💬', name: 'WhatsApp', color: '#25D366' },
            weibo: { icon: '💭', name: 'Weibo', color: '#E6162D' },
            wechat: { icon: '🟢', name: 'WeChat', color: '#09B83E' }
        };

        const DECORATIVE_ELEMENTS = {
            'line1': { type: 'line', label: 'decorativeLine1', style: 'solid', icon: '─' },
            'line2': { type: 'line', label: 'decorativeLine2', style: 'dashed', icon: '┄' },
            'line3': { type: 'line', label: 'decorativeLine3', style: 'dotted', icon: '┈' },
            'wave': { type: 'line', label: 'decorativeWave', style: 'wave', icon: '〰️' },
            'corner1': { type: 'corner', label: 'decorativeCorner1', icon: '◌' },
            'corner2': { type: 'corner', label: 'decorativeCorner2', icon: '◈' },
            'corner3': { type: 'corner', label: 'decorativeCorner3', icon: '✦' },
            'star': { type: 'icon', label: 'decorativeStar', icon: '⭐' },
            'heart': { type: 'icon', label: 'decorativeHeart', icon: '❤️' },
            'circle': { type: 'icon', label: 'decorativeCircle', icon: '●' },
            'triangle': { type: 'icon', label: 'decorativeTriangle', icon: '▲' },
            'diamond': { type: 'icon', label: 'decorativeDiamond', icon: '◆' },
            'flower': { type: 'icon', label: 'decorativeFlower', icon: '✿' },
            'spark': { type: 'icon', label: 'decorativeSpark', icon: '✨' },
            'leaf': { type: 'icon', label: 'decorativeLeaf', icon: '🍃' },
            'gear': { type: 'icon', label: 'decorativeGear', icon: '⚙️' },
            'ribbon': { type: 'line', label: 'decorativeRibbon', style: 'ribbon', icon: '🎀' },
            'sunburst': { type: 'icon', label: 'decorativeSunburst', icon: '🌟' },
            'zigzag': { type: 'line', label: 'decorativeZigzag', style: 'zigzag', icon: '≋' },
            'brackets': { type: 'corner', label: 'decorativeBrackets', icon: '❴' },
            'hexagon': { type: 'icon', label: 'decorativeHexagon', icon: '⬢' },
            'sparkle': { type: 'icon', label: 'decorativeSparkle', icon: '✺' },
            'dottrail': { type: 'line', label: 'decorativeDottrail', style: 'dottrail', icon: '⋯' }
        };

        function App() {
            const [loading, setLoading] = useState(false);
            const [lang, setLang] = useState(() => {
                const savedLang = localStorage.getItem('vc_lang');
                return savedLang && LANGUAGES[savedLang] ? savedLang : 'zh-TW';
            });
            const [theme, setTheme] = useState('dark');
            const [cardType, setCardType] = useState('main');
            const [customImage, setCustomImage] = useState(null);
            const [textStickers, setTextStickers] = useState([
                { id: Date.now(), text: 'Your Text Here !', x: 10, y: 10, size: 16, color: '#000000', style: 'text', opacity: 100, rotation: 0 }
            ]);
            const [qrContent, setQrContent] = useState('https://www.youtube.com/watch?v=dQw4w9WgXcQ');
            const [selectedTemplate, setSelectedTemplate] = useState('professional');
            
            const [cardData, setCardData] = useState({
                name: '名片範本',
                title: '專業人士',
                company: '公司名稱',
                email: 'email@example.com',
                phone: '+886-2-1234-5678',
                country: '台灣',
                address: '台北市中山區',
                website: 'https://example.com',
                intro: '熱衷於創新和用戶體驗設計',
                avatar: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 120 120%22%3E%3Cdefs%3E%3ClinearGradient id=%22grad%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22%3E%3Cstop offset=%220%25%22 style=%22stop-color:%23667eea;stop-opacity:1%22 /%3E%3Cstop offset=%22100%25%22 style=%22stop-color:%23764ba2;stop-opacity:1%22 /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width=%22120%22 height=%22120%22 fill=%22url(%23grad)%22/%3E%3Ccircle cx=%2260%22 cy=%2240%22 r=%2220%22 fill=%22%23fff%22/%3E%3Cpath d=%22M 30 85 Q 30 70 60 70 Q 90 70 90 85 Q 90 100 60 105 Q 30 100 30 85%22 fill=%22%23fff%22/%3E%3C/svg%3E',
                avatarShape: 'circular',
                borderRadiusOuter: 12,
                borderRadiusInner: 8,
                bgImage: CARD_TEMPLATES.professional.bgImage,
                bgGradientColor1: '#667eea',
                bgGradientColor2: '#764ba2',
                primaryColor: CARD_TEMPLATES.professional.colors.primary,
                secondaryColor: CARD_TEMPLATES.professional.colors.secondary,
                customCardBgColor: '#ffffff',
                customCardTextColor: '#000000',
                filterType: 'none',
                filterIntensity: 0,
                lightingEffect: 'none',
                lightingIntensity: 0,
                brightness: 100,
                contrast: 100,
                saturation: 100,
                hue: 0,
                sharpness: 0,
                blur: 0,
                shadowX: 0,
                shadowY: 8,
                shadowBlur: 24,
                shadowColor: 'rgba(0,0,0,0.15)',
                borderRadius: 12,
                borderWidth: 0,
                borderColor: '#000000',
                borderGradientColor1: '#667eea',
                borderGradientColor2: '#764ba2',
                borderUseGradient: false,
                padding: 25,
                margin: 0,
                fontFamily: "'Noto Sans CJK SC', sans-serif",
                fontSize: 14,
                animationEffect: 'pulse',
                animationDuration: 1,
                animationDelay: 0,
                animationLoops: 'infinite',
                animationEasing: 'ease-in-out',
                socialLinks: {},
                decorativeElements: [],
                customDecorations: [],
                ctaLabel: '立即聯繫',
                ctaUrl: 'mailto:email@example.com',
                ctaStyle: 'primary',
                showAddress: true,
                showIntro: true,
                showWebsite: true,
                showEmail: true,
                showPhone: true,
                showSocial: true,
                showCountryFlag: true,
                bgPatternType: 'none',
                bgPatternScale: 1,
                bgPatternOpacity: 1
            });

            const t = {
                ...TRANSLATIONS['en-US'],
                ...(TRANSLATIONS[lang] || {})
            };

            const applyTemplate = (templateName) => {
                const template = CARD_TEMPLATES[templateName];
                setCardData(prev => ({
                    ...prev,
                    bgImage: template.bgImage,
                    primaryColor: template.colors.primary,
                    secondaryColor: template.colors.secondary,
                    bgGradientColor1: template.colors.primary,
                    bgGradientColor2: template.colors.secondary,
                    borderGradientColor1: template.colors.primary,
                    borderGradientColor2: template.colors.secondary
                }));
                setSelectedTemplate(templateName);
            };

            useEffect(() => {
                document.body.className = `${theme}-theme`;
            }, [theme]);

            useEffect(() => {
                localStorage.setItem('vc_lang', lang);
                document.documentElement.lang = lang;
                const isRtlLang = lang === 'ar';
                document.documentElement.dir = isRtlLang ? 'rtl' : 'ltr';
                document.body.classList.toggle('rtl-lang', isRtlLang);
            }, [lang]);

            const toggleTheme = () => {
                setTheme(theme === 'light' ? 'dark' : 'light');
            };

            const updateCardData = (field, value) => {
                setCardData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const handleAvatarUpload = (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        updateCardData('avatar', event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleImageUpload = (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setCustomImage(event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addTextSticker = () => {
                const newSticker = {
                    id: Date.now(),
                    text: '文字貼圖',
                    x: 10,
                    y: 10,
                    size: 16,
                    color: '#000000',
                    style: 'text',
                    opacity: 100,
                    rotation: 0
                };
                setTextStickers([...textStickers, newSticker]);
            };

            const addImageSticker = (imageUrl) => {
                const newSticker = {
                    id: Date.now(),
                    type: 'image',
                    image: imageUrl,
                    x: 10,
                    y: 10,
                    width: 100,
                    height: 100,
                    opacity: 100,
                    rotation: 0
                };
                setTextStickers([...textStickers, newSticker]);
            };

            const updateSticker = (id, updates) => {
                setTextStickers(textStickers.map(s => 
                    s.id === id ? { ...s, ...updates } : s
                ));
            };

            const removeSticker = (id) => {
                setTextStickers(textStickers.filter(s => s.id !== id));
            };

            const addCustomDecoration = () => {
                const defaultKey = Object.keys(DECORATIVE_ELEMENTS)[0];
                const newDecoration = {
                    id: Date.now(),
                    element: defaultKey,
                    x: 10,
                    y: 10,
                    size: 32,
                    color: '#ffffff',
                    opacity: 80,
                    rotation: 0,
                    width: 120
                };
                setCardData(prev => ({
                    ...prev,
                    customDecorations: [...(prev.customDecorations || []), newDecoration]
                }));
            };

            const updateCustomDecoration = (id, updates) => {
                setCardData(prev => ({
                    ...prev,
                    customDecorations: (prev.customDecorations || []).map(item =>
                        item.id === id ? { ...item, ...updates } : item
                    )
                }));
            };

            const removeCustomDecoration = (id) => {
                setCardData(prev => ({
                    ...prev,
                    customDecorations: (prev.customDecorations || []).filter(item => item.id !== id)
                }));
            };

            useEffect(() => {
                const webMcpEndpoint = new URL('./api/webmcp', window.location.href).toString();
                const api = {
                    version: '1.2.0',
                    getState: () => ({
                        cardType,
                        lang,
                        theme,
                        cardData,
                        qrContent,
                        stickerCount: textStickers.length,
                        selectedTemplate,
                        webMcp: {
                            enabled: true,
                            protocol: 'webmcp-jsonrpc',
                            endpoint: webMcpEndpoint
                        }
                    }),
                    setCardType: (type) => setCardType(type),
                    setLanguage: (nextLang) => setLang(nextLang),
                    setThemeMode: (nextTheme) => setTheme(nextTheme),
                    updateField: (field, value) => updateCardData(field, value),
                    setQrContent: (value) => setQrContent(value),
                    applyTemplate: (templateName) => applyTemplate(templateName),
                    setBackgroundImage: (imageUrl) => setCustomImage(imageUrl),
                    updateLayout: (updates) => {
                        Object.entries(updates || {}).forEach(([field, value]) => updateCardData(field, value));
                    },
                    updateFields: (updates = {}) => {
                        Object.entries(updates || {}).forEach(([field, value]) => updateCardData(field, value));
                    },
                    setState: (statePatch = {}) => {
                        if (statePatch.cardType !== undefined) setCardType(statePatch.cardType);
                        if (statePatch.lang !== undefined) setLang(statePatch.lang);
                        if (statePatch.theme !== undefined) setTheme(statePatch.theme);
                        if (statePatch.qrContent !== undefined) setQrContent(statePatch.qrContent);
                        if (statePatch.selectedTemplate !== undefined) setSelectedTemplate(statePatch.selectedTemplate);
                        if (statePatch.customImage !== undefined) setCustomImage(statePatch.customImage);
                        if (statePatch.textStickers !== undefined && Array.isArray(statePatch.textStickers)) setTextStickers(statePatch.textStickers);
                        if (statePatch.cardData && typeof statePatch.cardData === 'object') {
                            setCardData(prev => ({ ...prev, ...statePatch.cardData }));
                        }
                    },
                    addTextSticker: () => addTextSticker(),
                    addImageSticker: (imageUrl) => addImageSticker(imageUrl),
                    updateSticker: (id, updates) => updateSticker(id, updates),
                    removeSticker: (id) => removeSticker(id),
                    dispatchPreviewAction: (action, payload = {}) => {
                        window.dispatchEvent(new CustomEvent('VC_PREVIEW_ACTION', { detail: { action, ...payload } }));
                    }
                };

                const webMcpTools = [
                    { name: 'card.getState', description: 'Get current app and card state' },
                    { name: 'card.setType', description: 'Set current card type', inputSchema: { cardType: 'main|qr|custom' } },
                    { name: 'card.setLanguage', description: 'Set UI language', inputSchema: { lang: 'locale code' } },
                    { name: 'card.setTheme', description: 'Set theme mode', inputSchema: { theme: 'light|dark' } },
                    { name: 'card.updateField', description: 'Update a card field', inputSchema: { field: 'string', value: 'any' } },
                    { name: 'card.updateFields', description: 'Update multiple fields', inputSchema: { updates: 'object' } },
                    { name: 'card.updateLayout', description: 'Update layout related fields', inputSchema: { updates: 'object' } },
                    { name: 'card.setQrContent', description: 'Set QR content', inputSchema: { value: 'string' } },
                    { name: 'card.applyTemplate', description: 'Apply design template', inputSchema: { templateName: 'string' } },
                    { name: 'card.setBackgroundImage', description: 'Set custom background image URL', inputSchema: { imageUrl: 'string' } },
                    { name: 'card.export', description: 'Export card', inputSchema: { format: 'png|jpg|webp|html|vcf' } },
                    { name: 'card.simulateAction', description: 'Simulate user action', inputSchema: { action: 'string', target: 'string', value: 'any' } },
                    { name: 'card.setState', description: 'Set top-level app state and cardData patch', inputSchema: { statePatch: 'object' } }
                ];

                const callWebMcpTool = async (name, input = {}) => {
                    switch (name) {
                        case 'card.getState':
                            return api.getState();
                        case 'card.setType':
                            api.setCardType(input.cardType);
                            return { ok: true };
                        case 'card.setLanguage':
                            api.setLanguage(input.lang);
                            return { ok: true };
                        case 'card.setTheme':
                            api.setThemeMode(input.theme);
                            return { ok: true };
                        case 'card.updateField':
                            api.updateField(input.field, input.value);
                            return { ok: true };
                        case 'card.updateFields':
                            api.updateFields(input.updates || {});
                            return { ok: true };
                        case 'card.updateLayout':
                            api.updateLayout(input.updates || {});
                            return { ok: true };
                        case 'card.setQrContent':
                            api.setQrContent(input.value || '');
                            return { ok: true };
                        case 'card.applyTemplate':
                            api.applyTemplate(input.templateName);
                            return { ok: true };
                        case 'card.setBackgroundImage':
                            api.setBackgroundImage(input.imageUrl || '');
                            return { ok: true };
                        case 'card.export': {
                            const format = input.format || 'png';
                            api.dispatchPreviewAction('export', { format });
                            return { ok: true, format };
                        }
                        case 'card.simulateAction': {
                            if (input.action === 'click') {
                                const clickTargetMap = {
                                    'export.png': { action: 'export', format: 'png' },
                                    'export.jpg': { action: 'export', format: 'jpg' },
                                    'export.webp': { action: 'export', format: 'webp' },
                                    'export.html': { action: 'export', format: 'html' },
                                    'export.vcf': { action: 'export', format: 'vcf' },
                                    'animation.replay': { action: 'animation.replay' },
                                    'animation.toggle': { action: 'animation.toggle' }
                                };
                                const mapped = clickTargetMap[input.target];
                                if (!mapped) throw new Error(`Unsupported click target: ${input.target}`);
                                api.dispatchPreviewAction(mapped.action, mapped);
                                return { ok: true, simulated: 'click', target: input.target };
                            }
                            if (input.action === 'input') {
                                api.updateField(input.target, input.value);
                                return { ok: true, simulated: 'input', target: input.target };
                            }
                            throw new Error(`Unsupported simulate action: ${input.action}`);
                        }
                        case 'card.setState':
                            api.setState(input.statePatch || {});
                            return { ok: true };
                        default:
                            throw new Error(`Unsupported WebMCP tool: ${name}`);
                    }
                };

                window.VirtualCardSkill = api;
                window.WebMCP = {
                    version: '0.2.0',
                    protocol: 'webmcp-jsonrpc',
                    endpoint: webMcpEndpoint,
                    listTools: () => webMcpTools,
                    callTool: (name, input) => callWebMcpTool(name, input)
                };

                // ─── Chromium-based WebMCP: listen for tool events ───────────
                // The webmcp-chromium.js module dispatches CustomEvents;
                // here we handle them by invoking the React-bound `api` methods
                // and firing a completion event back with the result.
                const fireCompletion = (requestId, data) => {
                    window.dispatchEvent(new CustomEvent('tool-completion-' + requestId, {
                        detail: { data }
                    }));
                };

                const chromiumToolHandlers = {
                    'webmcp-tool-getState': (detail) => {
                        return api.getState();
                    },
                    'webmcp-tool-setType': (detail) => {
                        api.setCardType(detail.cardType);
                        return { ok: true };
                    },
                    'webmcp-tool-setLanguage': (detail) => {
                        api.setLanguage(detail.lang);
                        return { ok: true };
                    },
                    'webmcp-tool-setTheme': (detail) => {
                        api.setThemeMode(detail.theme);
                        return { ok: true };
                    },
                    'webmcp-tool-updateField': (detail) => {
                        api.updateField(detail.field, detail.value);
                        return { ok: true };
                    },
                    'webmcp-tool-updateFields': (detail) => {
                        api.updateFields(detail.updates || {});
                        return { ok: true };
                    },
                    'webmcp-tool-updateLayout': (detail) => {
                        api.updateLayout(detail.updates || {});
                        return { ok: true };
                    },
                    'webmcp-tool-setQrContent': (detail) => {
                        api.setQrContent(detail.value || '');
                        return { ok: true };
                    },
                    'webmcp-tool-applyTemplate': (detail) => {
                        api.applyTemplate(detail.templateName);
                        return { ok: true };
                    },
                    'webmcp-tool-setBackgroundImage': (detail) => {
                        api.setBackgroundImage(detail.imageUrl || '');
                        return { ok: true };
                    },
                    'webmcp-tool-export': (detail) => {
                        const format = detail.format || 'png';
                        api.dispatchPreviewAction('export', { format });
                        return { ok: true, format };
                    },
                    'webmcp-tool-simulateAction': (detail) => {
                        if (detail.action === 'click') {
                            const clickTargetMap = {
                                'export.png': { action: 'export', format: 'png' },
                                'export.jpg': { action: 'export', format: 'jpg' },
                                'export.webp': { action: 'export', format: 'webp' },
                                'export.html': { action: 'export', format: 'html' },
                                'export.vcf': { action: 'export', format: 'vcf' },
                                'animation.replay': { action: 'animation.replay' },
                                'animation.toggle': { action: 'animation.toggle' }
                            };
                            const mapped = clickTargetMap[detail.target];
                            if (!mapped) throw new Error('Unsupported click target: ' + detail.target);
                            api.dispatchPreviewAction(mapped.action, mapped);
                            return { ok: true, simulated: 'click', target: detail.target };
                        }
                        if (detail.action === 'input') {
                            api.updateField(detail.target, detail.value);
                            return { ok: true, simulated: 'input', target: detail.target };
                        }
                        throw new Error('Unsupported simulate action: ' + detail.action);
                    },
                    'webmcp-tool-setState': (detail) => {
                        api.setState(detail.statePatch || {});
                        return { ok: true };
                    }
                };

                const chromiumListeners = [];
                Object.keys(chromiumToolHandlers).forEach(eventName => {
                    const handler = (evt) => {
                        const detail = evt.detail || {};
                        const requestId = detail.requestId;
                        try {
                            const result = chromiumToolHandlers[eventName](detail);
                            if (requestId) fireCompletion(requestId, result);
                        } catch (err) {
                            if (requestId) fireCompletion(requestId, { error: err.message });
                        }
                    };
                    window.addEventListener(eventName, handler);
                    chromiumListeners.push({ eventName, handler });
                });

                // Register tools with navigator.modelContext (Chromium native or polyfill)
                if (window.VirtualCardWebMCP) {
                    window.VirtualCardWebMCP.registerAll();
                }

                const onSkillMessage = async (event) => {
                    const payload = event.data;
                    if (!payload || payload.type !== 'VIRTUAL_CARD_SKILL') return;

                    const id = payload.id || Date.now();
                    const action = payload.action;
                    const args = payload.args || {};

                    try {
                        let result = null;
                        switch (action) {
                            case 'getState':
                                result = api.getState();
                                break;
                            case 'setCardType':
                                api.setCardType(args.cardType);
                                result = { ok: true };
                                break;
                            case 'setLanguage':
                                api.setLanguage(args.lang);
                                result = { ok: true };
                                break;
                            case 'setThemeMode':
                                api.setThemeMode(args.theme);
                                result = { ok: true };
                                break;
                            case 'updateField':
                                api.updateField(args.field, args.value);
                                result = { ok: true };
                                break;
                            case 'setQrContent':
                                api.setQrContent(args.value || '');
                                result = { ok: true };
                                break;
                            case 'applyTemplate':
                                api.applyTemplate(args.templateName);
                                result = { ok: true };
                                break;
                            case 'addTextSticker':
                                api.addTextSticker();
                                result = { ok: true };
                                break;
                            case 'addImageSticker':
                                api.addImageSticker(args.imageUrl);
                                result = { ok: true };
                                break;
                            case 'updateSticker':
                                api.updateSticker(args.id, args.updates || {});
                                result = { ok: true };
                                break;
                            case 'removeSticker':
                                api.removeSticker(args.id);
                                result = { ok: true };
                                break;
                            default:
                                throw new Error(`Unsupported action: ${action}`);
                        }

                        if (event.source && typeof event.source.postMessage === 'function') {
                            event.source.postMessage({ type: 'VIRTUAL_CARD_SKILL_RESULT', id, ok: true, result }, '*');
                        }
                    } catch (error) {
                        if (event.source && typeof event.source.postMessage === 'function') {
                            event.source.postMessage({ type: 'VIRTUAL_CARD_SKILL_RESULT', id, ok: false, error: String(error) }, '*');
                        }
                    }
                };

                const onWebMcpMessage = async (event) => {
                    const payload = event.data;
                    if (!payload || payload.type !== 'WEB_MCP_REQUEST') return;

                    const id = payload.id || Date.now();
                    const method = payload.method;
                    const params = payload.params || {};
                    try {
                        let result;
                        if (method === 'tools/list') {
                            result = { tools: webMcpTools };
                        } else if (method === 'tools/call') {
                            result = { content: [{ type: 'json', data: await callWebMcpTool(params.name, params.arguments || {}) }] };
                        } else {
                            throw new Error(`Unsupported WebMCP method: ${method}`);
                        }

                        if (event.source && typeof event.source.postMessage === 'function') {
                            event.source.postMessage({ type: 'WEB_MCP_RESPONSE', jsonrpc: '2.0', id, result }, '*');
                        }
                    } catch (error) {
                        if (event.source && typeof event.source.postMessage === 'function') {
                            event.source.postMessage({
                                type: 'WEB_MCP_RESPONSE',
                                jsonrpc: '2.0',
                                id,
                                error: { code: -32000, message: String(error) }
                            }, '*');
                        }
                    }
                };

                const onServiceWorkerMessage = async (event) => {
                    const payload = event.data;
                    if (!payload || payload.type !== 'WEB_MCP_HTTP_REQUEST') return;
                    const port = event.ports && event.ports[0];
                    if (!port) return;

                    const rpc = payload.payload || {};
                    const id = rpc.id || payload.id || Date.now();

                    try {
                        let result;
                        if (rpc.method === 'tools/list') {
                            result = { tools: webMcpTools };
                        } else if (rpc.method === 'tools/call') {
                            result = { content: [{ type: 'json', data: await callWebMcpTool(rpc.params?.name, rpc.params?.arguments || {}) }] };
                        } else {
                            throw new Error(`Unsupported WebMCP method: ${rpc.method}`);
                        }
                        port.postMessage({ jsonrpc: '2.0', id, result });
                    } catch (error) {
                        port.postMessage({
                            jsonrpc: '2.0',
                            id,
                            error: { code: -32000, message: String(error) }
                        });
                    }
                };

                window.addEventListener('message', onSkillMessage);
                window.addEventListener('message', onWebMcpMessage);
                navigator.serviceWorker?.addEventListener('message', onServiceWorkerMessage);

                return () => {
                    window.removeEventListener('message', onSkillMessage);
                    window.removeEventListener('message', onWebMcpMessage);
                    navigator.serviceWorker?.removeEventListener('message', onServiceWorkerMessage);
                    // Cleanup Chromium tool event listeners
                    chromiumListeners.forEach(({ eventName, handler }) => {
                        window.removeEventListener(eventName, handler);
                    });
                    if (window.VirtualCardSkill === api) {
                        delete window.VirtualCardSkill;
                    }
                    if (window.WebMCP) {
                        delete window.WebMCP;
                    }
                };
            }, [cardType, lang, theme, cardData, qrContent, textStickers]);

            return (
                <>
                    {loading && (
                        <div className="loading-overlay">
                            <div className="loader"></div>
                        </div>
                    )}
                    <div className="app-container">
                        <ControlPanel
                            cardData={cardData}
                            updateCardData={updateCardData}
                            handleAvatarUpload={handleAvatarUpload}
                            lang={lang}
                            setLang={setLang}
                            t={t}
                            theme={theme}
                            toggleTheme={toggleTheme}
                            cardType={cardType}
                            setCardType={setCardType}
                            customImage={customImage}
                            handleImageUpload={handleImageUpload}
                            textStickers={textStickers}
                            addTextSticker={addTextSticker}
                            addImageSticker={addImageSticker}
                            updateSticker={updateSticker}
                            removeSticker={removeSticker}
                            qrContent={qrContent}
                            setQrContent={setQrContent}
                            selectedTemplate={selectedTemplate}
                            applyTemplate={applyTemplate}
                            addCustomDecoration={addCustomDecoration}
                            updateCustomDecoration={updateCustomDecoration}
                            removeCustomDecoration={removeCustomDecoration}
                        />
                        <PreviewPanel
                            cardData={cardData}
                            t={t}
                            setLoading={setLoading}
                            cardType={cardType}
                            theme={theme}
                            customImage={customImage}
                            textStickers={textStickers}
                            qrContent={qrContent}
                            selectedTemplate={selectedTemplate}
                            applyTemplate={applyTemplate}
                            customDecorations={cardData.customDecorations}
                        />
                    </div>
                </>
            );
        }

        function ControlPanel({ cardData, updateCardData, handleAvatarUpload, lang, setLang, t, theme, toggleTheme, cardType, setCardType, customImage, handleImageUpload, textStickers, addTextSticker, addImageSticker, updateSticker, removeSticker, qrContent, setQrContent, selectedTemplate, applyTemplate, addCustomDecoration, updateCustomDecoration, removeCustomDecoration }) {
            const [activeTab, setActiveTab] = useState('basic');
            const getTemplateName = (key, fallbackName) => t[TEMPLATE_LABEL_KEYS[key]] || fallbackName;

            return (
                <div className="control-panel">
                    <div className="panel-header">
                        <h1>{t.title}</h1>
                        <div className="header-controls">
                            <button className="theme-toggle" onClick={toggleTheme}>
                                {theme === 'light' ? '🌙' : '☀️'}
                            </button>
                            <select 
                                className="lang-selector"
                                value={lang}
                                onChange={(e) => setLang(e.target.value)}
                            >
                                {Object.entries(LANGUAGES).map(([code, { name, flag }]) => (
                                    <option key={code} value={code}>{flag} {name}</option>
                                ))}
                            </select>
                            <a href="https://github.com/Lian0123/virtual-business-card-project" target="_blank" rel="noopener noreferrer" className="github-link" title={t.githubProject}>
                                🐙
                            </a>
                            <a href="https://github.com/Lian0123" target="_blank" rel="noopener noreferrer" className="github-link" title={t.githubUser}>
                                👤
                            </a>
                        </div>
                    </div>

                    <div className="panel-content">
                        <div className="tabs">
                            <button className={`tab ${activeTab === 'basic' ? 'active' : ''}`} onClick={() => setActiveTab('basic')}>{t.basicSettings}</button>
                            <button className={`tab ${activeTab === 'advanced' ? 'active' : ''}`} onClick={() => setActiveTab('advanced')}>{t.advancedSettings}</button>
                        </div>

                        {activeTab === 'basic' && (
                            <>
                                <div className="section">
                                    <div className="section-title">📋 {t.cardType}</div>
                                    <div className="card-type-buttons">
                                        {[
                                            { type: 'main', label: t.mainLabel },
                                            { type: 'qr', label: t.qrLabel },
                                            { type: 'custom', label: t.customLabel }
                                        ].map(item => (
                                            <button
                                                key={item.type}
                                                className={`card-type-btn ${cardType === item.type ? 'active' : ''}`}
                                                onClick={() => setCardType(item.type)}
                                            >
                                                {item.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="section">
                                    <div className="section-title">👤 {t.avatar}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.avatarShape}</label>
                                        <div className="button-group">
                                            {['circular', 'square', 'roundedSquare'].map(shape => (
                                                <button
                                                    key={shape}
                                                    className={`button-toggle ${cardData.avatarShape === shape ? 'active' : ''}`}
                                                    onClick={() => updateCardData('avatarShape', shape)}
                                                >
                                                    {t[shape === 'circular' ? 'circular' : shape === 'square' ? 'square' : 'roundedSquare']}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {cardData.avatarShape === 'roundedSquare' && (
                                        <div className="control-group">
                                            <label className="control-label">{t.innerRadius}</label>
                                            <div className="slider-wrapper">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="20"
                                                    value={cardData.borderRadiusInner}
                                                    onChange={(e) => updateCardData('borderRadiusInner', parseInt(e.target.value))}
                                                />
                                                <span className="slider-value">{cardData.borderRadiusInner}px</span>
                                            </div>
                                        </div>
                                    )}

                                    <div className="control-group">
                                        <label className="control-label">{t.uploadAvatar}</label>
                                        <div className="file-input-wrapper">
                                            <input
                                                type="file"
                                                id="avatar-upload"
                                                accept="image/*"
                                                onChange={handleAvatarUpload}
                                            />
                                            <label htmlFor="avatar-upload" className="file-input-label">
                                                {cardData.avatar && !cardData.avatar.includes('placeholder') ? t.avatarUploaded : t.clickUploadAvatar}
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">📋 {t.basicInfo}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.nameLabel}</label>
                                        <input
                                            type="text"
                                            className="control-input"
                                            value={cardData.name}
                                            onChange={(e) => updateCardData('name', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.titleLabel}</label>
                                        <input
                                            type="text"
                                            className="control-input"
                                            value={cardData.title}
                                            onChange={(e) => updateCardData('title', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.companyLabel}</label>
                                        <input
                                            type="text"
                                            className="control-input"
                                            value={cardData.company}
                                            onChange={(e) => updateCardData('company', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.countryLabel}</label>
                                        <input
                                            type="text"
                                            className="control-input"
                                            value={cardData.country}
                                            onChange={(e) => updateCardData('country', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">
                                            {t.showCountryFlag || '顯示國旗'}
                                        </label>
                                        <button
                                            type="button"
                                            className={`button-toggle ${cardData.showCountryFlag ? 'active' : ''}`}
                                            style={{ width: '100%' }}
                                            onClick={() => updateCardData('showCountryFlag', !cardData.showCountryFlag)}
                                        >
                                            {cardData.showCountryFlag ? '🏳️ ON' : '🚫 OFF'}
                                        </button>
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.addressLabel}</label>
                                        <input
                                            type="text"
                                            className="control-input"
                                            value={cardData.address}
                                            onChange={(e) => updateCardData('address', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.emailLabel}</label>
                                        <input
                                            type="email"
                                            className="control-input"
                                            value={cardData.email}
                                            onChange={(e) => updateCardData('email', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.phoneLabel}</label>
                                        <input
                                            type="tel"
                                            className="control-input"
                                            value={cardData.phone}
                                            onChange={(e) => updateCardData('phone', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.websiteLabel}</label>
                                        <input
                                            type="url"
                                            className="control-input"
                                            value={cardData.website}
                                            onChange={(e) => updateCardData('website', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.introLabel || '自我介紹'}</label>
                                        <textarea
                                            className="control-input"
                                            value={cardData.intro}
                                            onChange={(e) => updateCardData('intro', e.target.value)}
                                            rows="3"
                                        />
                                    </div>
                                </div>

                                {cardType === 'main' && (
                                    <>
                                        <div className="divider"></div>
                                        <div className="section">
                                            <div className="section-title">🌐 {t.socialMedia}</div>
                                            <div style={{ marginBottom: '12px' }}>
                                                {Object.entries(SOCIAL_MEDIA).map(([key, media]) => (
                                                    <div key={key} className="control-group">
                                                        <label className="control-label">{media.icon} {media.name}</label>
                                                        <input
                                                            type="text"
                                                            className="control-input"
                                                            placeholder={`https://...`}
                                                            value={cardData.socialLinks?.[key] || ''}
                                                            onChange={(e) => updateCardData('socialLinks', {
                                                                ...cardData.socialLinks,
                                                                [key]: e.target.value
                                                            })}
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </>
                                )}

                                {cardType === 'qr' && (
                                    <>
                                        <div className="divider"></div>
                                        <div className="section">
                                            <div className="section-title">📱 {t.qrSettings}</div>
                                            <div className="control-group">
                                                <label className="control-label">{t.qrContentHint}</label>
                                                <textarea
                                                    className="control-input"
                                                    value={qrContent}
                                                    onChange={(e) => setQrContent(e.target.value)}
                                                    placeholder={t.qrContentPlaceholder}
                                                    rows="3"
                                                />
                                            </div>
                                        </div>
                                    </>
                                )}

                                {cardType === 'custom' && (
                                    <>
                                        <div className="divider"></div>
                                        <div className="section">
                                            <div className="section-title">🖼️ {t.customCardTitle}</div>
                                            
                                            <div className="control-group">
                                                <label className="control-label">{t.bgColorLabel}</label>
                                                <input
                                                    type="color"
                                                    className="color-picker"
                                                    value={cardData.customCardBgColor}
                                                    onChange={(e) => updateCardData('customCardBgColor', e.target.value)}
                                                />
                                            </div>

                                            <div className="control-group">
                                                <label className="control-label">{t.textColorLabel}</label>
                                                <input
                                                    type="color"
                                                    className="color-picker"
                                                    value={cardData.customCardTextColor}
                                                    onChange={(e) => updateCardData('customCardTextColor', e.target.value)}
                                                />
                                            </div>

                                            <div className="control-group">
                                                <label className="control-label">{t.uploadBgLabel}</label>
                                                <div className="file-input-wrapper">
                                                    <input
                                                        type="file"
                                                        id="bg-image-upload"
                                                        accept="image/*"
                                                        onChange={handleImageUpload}
                                                    />
                                                    <label htmlFor="bg-image-upload" className="file-input-label">
                                                        {customImage ? t.bgUploaded : t.clickUploadBg}
                                                    </label>
                                                </div>
                                            </div>

                                            <button
                                                onClick={addTextSticker}
                                                className="btn-export"
                                                style={{ width: '100%', marginTop: '12px' }}
                                            >
                                                {t.addTextStickerBtn}
                                            </button>

                                            <button
                                                onClick={() => {
                                                    const input = document.createElement('input');
                                                    input.type = 'file';
                                                    input.accept = 'image/*';
                                                    input.onchange = (e) => {
                                                        const file = e.target.files[0];
                                                        if (file) {
                                                            const reader = new FileReader();
                                                            reader.onload = (event) => {
                                                                addImageSticker(event.target.result);
                                                            };
                                                            reader.readAsDataURL(file);
                                                        }
                                                    };
                                                    input.click();
                                                }}
                                                className="btn-export alt"
                                                style={{ width: '100%', marginTop: '8px' }}
                                            >
                                                {t.addImageStickerBtn}
                                            </button>

                                            {textStickers.length > 0 && (
                                                <>
                                                    <div className="divider" style={{ margin: '16px 0' }}></div>
                                                    {textStickers.map((sticker) => (
                                                        <StickerEditor
                                                            key={sticker.id}
                                                            sticker={sticker}
                                                            onUpdate={updateSticker}
                                                            onRemove={removeSticker}
                                                            t={t}
                                                        />
                                                    ))}
                                                </>
                                            )}
                                        </div>
                                    </>
                                )}
                            </>
                        )}

                        {activeTab === 'advanced' && (
                            <>
                                <div className="section">
                                    <div className="section-title">🎨 {t.designTemplate}</div>
                                    <div className="preset-grid">
                                        {Object.entries(CARD_TEMPLATES).map(([key, template]) => (
                                            <button
                                                key={key}
                                                className={`preset-btn ${selectedTemplate === key ? 'active' : ''}`}
                                                onClick={() => applyTemplate(key)}
                                                title={getTemplateName(key, template.name)}
                                                style={{
                                                    background: template.bgImage,
                                                    backgroundSize: 'cover',
                                                    backgroundPosition: 'center'
                                                }}
                                            >
                                                {getTemplateName(key, template.name).charAt(0)}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">🎨 {t.gradientControl}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.gradientColor1}</label>
                                        <input
                                            type="color"
                                            className="color-picker"
                                            value={cardData.bgGradientColor1 || '#667eea'}
                                            onChange={(e) => updateCardData('bgGradientColor1', e.target.value)}
                                        />
                                    </div>
                                    <div className="control-group">
                                        <label className="control-label">{t.gradientColor2}</label>
                                        <input
                                            type="color"
                                            className="color-picker"
                                            value={cardData.bgGradientColor2 || '#764ba2'}
                                            onChange={(e) => updateCardData('bgGradientColor2', e.target.value)}
                                        />
                                    </div>
                                    <div style={{ marginTop: '8px', padding: '8px', borderRadius: '4px', background: `linear-gradient(135deg, ${cardData.bgGradientColor1 || '#667eea'} 0%, ${cardData.bgGradientColor2 || '#764ba2'} 100%)`, height: '40px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}></div>
                                    <div style={{ marginTop: '10px' }}>
                                        <label className="control-label">{t.colorPresetsLabel}</label>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '8px' }}>
                                            {Object.entries(CARD_TEMPLATES).map(([key, template]) => (
                                                <button
                                                    key={`color-${key}`}
                                                    type="button"
                                                    className="preset-btn"
                                                    title={getTemplateName(key, template.name)}
                                                    style={{ background: template.bgImage, borderColor: 'rgba(255,255,255,0.2)' }}
                                                    onClick={() => {
                                                        updateCardData('bgGradientColor1', template.colors.primary);
                                                        updateCardData('bgGradientColor2', template.colors.secondary);
                                                        updateCardData('borderGradientColor1', template.colors.primary);
                                                        updateCardData('borderGradientColor2', template.colors.secondary);
                                                    }}
                                                ></button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="section">
                                    <div className="section-title">✨ {t.shadowControl}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.horizontalShift}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="-20"
                                                max="20"
                                                value={cardData.shadowX}
                                                onChange={(e) => updateCardData('shadowX', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.shadowX}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.verticalShift}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="30"
                                                value={cardData.shadowY}
                                                onChange={(e) => updateCardData('shadowY', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.shadowY}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.blurDegree}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="40"
                                                value={cardData.shadowBlur}
                                                onChange={(e) => updateCardData('shadowBlur', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.shadowBlur}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.shadowColorLabel}</label>
                                        <input
                                            type="color"
                                            className="color-picker"
                                            value={cardData.shadowColor}
                                            onChange={(e) => updateCardData('shadowColor', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">🎬 {t.filters}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.filterTypeLabel}</label>
                                        <select
                                            className="control-select"
                                            value={cardData.filterType}
                                            onChange={(e) => updateCardData('filterType', e.target.value)}
                                        >
                                            <option value="none">{t.filterNone}</option>
                                            <option value="blur">{t.filterBlur}</option>
                                            <option value="grayscale">{t.filterGrayscale}</option>
                                            <option value="invert">{t.filterInvert}</option>
                                            <option value="sepia">{t.filterSepia}</option>
                                        </select>
                                    </div>

                                    {cardData.filterType !== 'none' && (
                                        <div className="control-group">
                                            <label className="control-label">{t.filterIntensity}</label>
                                            <div className="slider-wrapper">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="100"
                                                    value={cardData.filterIntensity}
                                                    onChange={(e) => updateCardData('filterIntensity', parseInt(e.target.value))}
                                                />
                                                <span className="slider-value">{cardData.filterIntensity}%</span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">💡 {t.lighting}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.lightingTypeLabel}</label>
                                        <select
                                            className="control-select"
                                            value={cardData.lightingEffect}
                                            onChange={(e) => updateCardData('lightingEffect', e.target.value)}
                                        >
                                            <option value="none">{t.lightingNone}</option>
                                            <option value="shadow">{t.lightingShadow}</option>
                                            <option value="glow">{t.lightingGlow}</option>
                                        </select>
                                    </div>

                                    {cardData.lightingEffect !== 'none' && (
                                        <div className="control-group">
                                            <label className="control-label">{t.lightingIntensity}</label>
                                            <div className="slider-wrapper">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="100"
                                                    value={cardData.lightingIntensity}
                                                    onChange={(e) => updateCardData('lightingIntensity', parseInt(e.target.value))}
                                                />
                                                <span className="slider-value">{cardData.lightingIntensity}%</span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">🎨 {t.visualAdjust}</div>
                                    
                                    <div className="control-group">
                                        <label className="control-label">{t.brightnessLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="200"
                                                value={cardData.brightness}
                                                onChange={(e) => updateCardData('brightness', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.brightness}%</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.contrastLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="200"
                                                value={cardData.contrast}
                                                onChange={(e) => updateCardData('contrast', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.contrast}%</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.saturationLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="200"
                                                value={cardData.saturation}
                                                onChange={(e) => updateCardData('saturation', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.saturation}%</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.hueLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="360"
                                                value={cardData.hue}
                                                onChange={(e) => updateCardData('hue', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.hue}°</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.sharpnessLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="-100"
                                                max="100"
                                                value={cardData.sharpness}
                                                onChange={(e) => updateCardData('sharpness', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.sharpness}%</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.blurLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="10"
                                                step="0.1"
                                                value={cardData.blur}
                                                onChange={(e) => updateCardData('blur', parseFloat(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.blur.toFixed(1)}px</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">🎯 {t.borderControl}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.outerRadius}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="50"
                                                value={cardData.borderRadiusOuter}
                                                onChange={(e) => updateCardData('borderRadiusOuter', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.borderRadiusOuter}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.innerRadius}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="50"
                                                value={cardData.borderRadiusInner}
                                                onChange={(e) => updateCardData('borderRadiusInner', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.borderRadiusInner}px</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="divider"></div>

                                <div className="section">
                                    <div className="section-title">🎪 {t.fontAnimation}</div>
                                    <div className="control-group">
                                        <label className="control-label">{t.fontLabel}</label>
                                        <select
                                            className="control-select"
                                            value={cardData.fontFamily}
                                            onChange={(e) => updateCardData('fontFamily', e.target.value)}
                                        >
                                            <option value="'Noto Sans CJK SC', sans-serif">Noto Sans（推薦）</option>
                                            <option value="Georgia, serif">Georgia</option>
                                            <option value="'Courier New', monospace">Courier New</option>
                                        </select>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.baseFontSize}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="10"
                                                max="24"
                                                value={cardData.fontSize}
                                                onChange={(e) => updateCardData('fontSize', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.fontSize}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.borderMode}</label>
                                        <div style={{ display: 'flex', gap: '8px' }}>
                                            <button
                                                onClick={() => updateCardData('borderUseGradient', false)}
                                                className={`btn-small ${!cardData.borderUseGradient ? 'active' : ''}`}
                                                style={{
                                                    flex: 1,
                                                    padding: '8px',
                                                    background: !cardData.borderUseGradient ? '#667eea' : 'rgba(102, 126, 234, 0.2)',
                                                    color: '#fff',
                                                    border: 'none',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer',
                                                    fontSize: '12px',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                {t.solidColor}
                                            </button>
                                            <button
                                                onClick={() => updateCardData('borderUseGradient', true)}
                                                className={`btn-small ${cardData.borderUseGradient ? 'active' : ''}`}
                                                style={{
                                                    flex: 1,
                                                    padding: '8px',
                                                    background: cardData.borderUseGradient ? '#667eea' : 'rgba(102, 126, 234, 0.2)',
                                                    color: '#fff',
                                                    border: 'none',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer',
                                                    fontSize: '12px',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                {t.gradientBorder}
                                            </button>
                                        </div>
                                    </div>

                                    {!cardData.borderUseGradient ? (
                                        <div className="control-group">
                                            <label className="control-label">{t.borderColorLabel}</label>
                                            <input
                                                type="color"
                                                className="color-picker"
                                                value={cardData.borderColor}
                                                onChange={(e) => updateCardData('borderColor', e.target.value)}
                                            />
                                        </div>
                                    ) : (
                                        <>
                                            <div className="control-group">
                                                <label className="control-label">{t.borderGradient1}</label>
                                                <input
                                                    type="color"
                                                    className="color-picker"
                                                    value={cardData.borderGradientColor1}
                                                    onChange={(e) => updateCardData('borderGradientColor1', e.target.value)}
                                                />
                                            </div>
                                            <div className="control-group">
                                                <label className="control-label">{t.borderGradient2}</label>
                                                <input
                                                    type="color"
                                                    className="color-picker"
                                                    value={cardData.borderGradientColor2}
                                                    onChange={(e) => updateCardData('borderGradientColor2', e.target.value)}
                                                />
                                            </div>
                                        </>
                                    )}
                                    
                                    <div className="control-group">
                                        <label className="control-label">{t.borderWidthLabel}</label>
                                        <div className="slider-wrapper">
                                            <input
                                                type="range"
                                                min="0"
                                                max="10"
                                                value={cardData.borderWidth}
                                                onChange={(e) => updateCardData('borderWidth', parseInt(e.target.value))}
                                            />
                                            <span className="slider-value">{cardData.borderWidth}px</span>
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <label className="control-label">{t.animation}</label>
                                        <select
                                            className="control-select"
                                            value={cardData.animationEffect}
                                            onChange={(e) => updateCardData('animationEffect', e.target.value)}
                                        >
                                            {Object.entries(ANIMATION_OPTIONS).map(([key, opt]) => (
                                                <option key={key} value={key}>{t[opt.label]}</option>
                                            ))}
                                        </select>
                                    </div>

                                    {cardData.animationEffect !== 'none' && (
                                        <>
                                            <div className="control-group">
                                                <label className="control-label">{t.animationDuration}</label>
                                                <div className="slider-wrapper">
                                                    <input
                                                        type="range"
                                                        min="0.5"
                                                        max="3"
                                                        step="0.1"
                                                        value={cardData.animationDuration}
                                                        onChange={(e) => updateCardData('animationDuration', parseFloat(e.target.value))}
                                                    />
                                                    <span className="slider-value">{cardData.animationDuration}s</span>
                                                </div>
                                            </div>

                                            <div className="control-group">
                                                <label className="control-label">{t.animationDelay}</label>
                                                <div className="slider-wrapper">
                                                    <input
                                                        type="range"
                                                        min="0"
                                                        max="2"
                                                        step="0.1"
                                                        value={cardData.animationDelay}
                                                        onChange={(e) => updateCardData('animationDelay', parseFloat(e.target.value))}
                                                    />
                                                    <span className="slider-value">{cardData.animationDelay}s</span>
                                                </div>
                                            </div>

                                            <div className="control-group">
                                                <label className="control-label">{t.animationLoops}</label>
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    <button
                                                        onClick={() => updateCardData('animationLoops', 'infinite')}
                                                        className={`button-toggle ${cardData.animationLoops === 'infinite' ? 'active' : ''}`}
                                                        style={{ flex: 1 }}
                                                    >
                                                        {t.infiniteLoop}
                                                    </button>
                                                    <button
                                                        onClick={() => updateCardData('animationLoops', '1')}
                                                        className={`button-toggle ${cardData.animationLoops === '1' ? 'active' : ''}`}
                                                        style={{ flex: 1 }}
                                                    >
                                                        {t.onceLoop}
                                                    </button>
                                                    <button
                                                        onClick={() => updateCardData('animationLoops', '3')}
                                                        className={`button-toggle ${cardData.animationLoops === '3' ? 'active' : ''}`}
                                                        style={{ flex: 1 }}
                                                    >
                                                        {t.threeTimesLoop}
                                                    </button>
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    <div className="section">
                                        <div className="section-title" style={{ marginBottom: '12px' }}>🎯 {t.freeDecorationTitle || '自由定位裝飾'}</div>
                                        <button
                                            onClick={addCustomDecoration}
                                            className="btn-export"
                                            style={{ width: '100%', marginBottom: '12px', padding: '10px', fontSize: '13px' }}
                                        >
                                            + {t.addDecorationBtn || '新增裝飾'}
                                        </button>
                                        {(cardData.customDecorations || []).map((deco) => (
                                            <div key={deco.id} style={{ padding: '10px', background: 'rgba(102,126,234,0.1)', borderRadius: '8px', marginBottom: '8px', border: '1px solid rgba(255,255,255,0.1)' }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                                                    <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#667eea' }}>{DECORATIVE_ELEMENTS[deco.element]?.icon} {t[DECORATIVE_ELEMENTS[deco.element]?.label]}</span>
                                                    <button onClick={() => removeCustomDecoration(deco.id)} style={{ padding: '3px 8px', background: '#ff6348', color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '11px' }}>🗑️</button>
                                                </div>
                                                <div className="control-group" style={{ marginBottom: '6px' }}>
                                                    <label className="control-label">{t.elementSelectLabel || '元素'}</label>
                                                    <select className="control-select" value={deco.element} onChange={(e) => updateCustomDecoration(deco.id, { element: e.target.value })}>
                                                        {Object.entries(DECORATIVE_ELEMENTS).map(([key, elem]) => (
                                                            <option key={key} value={key}>{elem.icon} {t[elem.label]}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '6px', marginBottom: '6px' }}>
                                                    <div>
                                                        <label className="control-label">X %</label>
                                                        <div className="slider-wrapper">
                                                            <input type="range" min="0" max="100" value={deco.x || 10} onChange={(e) => updateCustomDecoration(deco.id, { x: parseInt(e.target.value) })} />
                                                            <span className="slider-value">{deco.x || 10}%</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label className="control-label">Y %</label>
                                                        <div className="slider-wrapper">
                                                            <input type="range" min="0" max="100" value={deco.y || 10} onChange={(e) => updateCustomDecoration(deco.id, { y: parseInt(e.target.value) })} />
                                                            <span className="slider-value">{deco.y || 10}%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '6px', marginBottom: '6px' }}>
                                                    <div>
                                                        <label className="control-label">{t.sizeLabel || '大小'}</label>
                                                        <div className="slider-wrapper">
                                                            <input type="range" min="12" max="80" value={deco.size || 28} onChange={(e) => updateCustomDecoration(deco.id, { size: parseInt(e.target.value) })} />
                                                            <span className="slider-value">{deco.size || 28}px</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label className="control-label">{t.rotationLabel || '旋轉'}</label>
                                                        <div className="slider-wrapper">
                                                            <input type="range" min="0" max="360" value={deco.rotation || 0} onChange={(e) => updateCustomDecoration(deco.id, { rotation: parseInt(e.target.value) })} />
                                                            <span className="slider-value">{deco.rotation || 0}°</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '6px' }}>
                                                    <div>
                                                        <label className="control-label">{t.colorLabel || '顏色'}</label>
                                                        <input type="color" className="color-picker" style={{ height: '32px' }} value={deco.color || '#ffffff'} onChange={(e) => updateCustomDecoration(deco.id, { color: e.target.value })} />
                                                    </div>
                                                    <div>
                                                        <label className="control-label">{t.opacityLabel || '不透明度'}</label>
                                                        <div className="slider-wrapper">
                                                            <input type="range" min="0" max="100" value={deco.opacity ?? 80} onChange={(e) => updateCustomDecoration(deco.id, { opacity: parseInt(e.target.value) })} />
                                                            <span className="slider-value">{deco.opacity ?? 80}%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="section">
                                        <div className="section-title">🎨 {t.previewPattern || '背景圖案'}</div>
                                        <div className="control-group">
                                            <label className="control-label">{t.bgPatternTitle}</label>
                                            <select
                                                className="control-select"
                                                value={cardData.bgPatternType}
                                                onChange={(e) => updateCardData('bgPatternType', e.target.value)}
                                            >
                                                <option value="none">{t.patternNone}</option>
                                                <option value="dots">{t.patternDots}</option>
                                                <option value="grid">{t.patternGrid}</option>
                                                <option value="lines">{t.patternLines}</option>
                                                <option value="waves">{t.patternWaves}</option>
                                                <option value="diagonal">{t.patternDiagonal}</option>
                                                <option value="checkered">{t.patternCheckered}</option>
                                                <option value="mesh">{t.patternMesh}</option>
                                                <option value="sprinkles">{t.patternSprinkles}</option>
                                            </select>
                                        </div>

                                        {cardData.bgPatternType !== 'none' && (
                                            <>
                                                <div className="control-group">
                                                    <label className="control-label">{t.patternOpacityLabel}</label>
                                                    <div className="slider-wrapper">
                                                        <input
                                                            type="range"
                                                            min="0"
                                                            max="1"
                                                            step="0.1"
                                                            value={cardData.bgPatternOpacity}
                                                            onChange={(e) => updateCardData('bgPatternOpacity', parseFloat(e.target.value))}
                                                        />
                                                        <span className="slider-value">{(cardData.bgPatternOpacity * 100).toFixed(0)}%</span>
                                                    </div>
                                                </div>

                                                <div className="control-group">
                                                    <label className="control-label">{t.patternScaleLabel}</label>
                                                    <div className="slider-wrapper">
                                                        <input
                                                            type="range"
                                                            min="0.5"
                                                            max="3"
                                                            step="0.1"
                                                            value={cardData.bgPatternScale}
                                                            onChange={(e) => updateCardData('bgPatternScale', parseFloat(e.target.value))}
                                                        />
                                                        <span className="slider-value">{cardData.bgPatternScale.toFixed(1)}x</span>
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        function PreviewPanel({ cardData, t, setLoading, cardType, theme, customImage, textStickers, qrContent, selectedTemplate, applyTemplate, customDecorations = [] }) {
            const cardRef = useRef(null);
            const freeDecorations = customDecorations && customDecorations.length ? customDecorations : (cardData.customDecorations || []);
            const COUNTRY_FLAG_MAP = {
                '台灣': '🇹🇼', Taiwan: '🇹🇼', '臺灣': '🇹🇼',
                '日本': '🇯🇵', Japan: '🇯🇵',
                '韓國': '🇰🇷', '南韓': '🇰🇷', Korea: '🇰🇷',
                '泰國': '🇹🇭', Thailand: '🇹🇭',
                '越南': '🇻🇳', Vietnam: '🇻🇳',
                '法國': '🇫🇷', France: '🇫🇷',
                '德國': '🇩🇪', Germany: '🇩🇪',
                '西班牙': '🇪🇸', Spain: '🇪🇸',
                '葡萄牙': '🇵🇹', Portugal: '🇵🇹',
                '美國': '🇺🇸', USA: '🇺🇸', US: '🇺🇸',
                '英國': '🇬🇧', UK: '🇬🇧', Britain: '🇬🇧',
                '中國': '🇨🇳', China: '🇨🇳',
                '香港': '🇭🇰', HongKong: '🇭🇰',
                '澳門': '🇲🇴', Macao: '🇲🇴',
                '新加坡': '🇸🇬', Singapore: '🇸🇬',
                '馬來西亞': '🇲🇾', Malaysia: '🇲🇾',
                '印尼': '🇮🇩', Indonesia: '🇮🇩',
                '菲律賓': '🇵🇭', Philippines: '🇵🇭',
                '印度': '🇮🇳', India: '🇮🇳',
                '澳洲': '🇦🇺', Australia: '🇦🇺',
                '加拿大': '🇨🇦', Canada: '🇨🇦',
                '巴西': '🇧🇷', Brazil: '🇧🇷',
                '墨西哥': '🇲🇽', Mexico: '🇲🇽',
                '義大利': '🇮🇹', Italy: '🇮🇹',
                '荷蘭': '🇳🇱', Netherlands: '🇳🇱',
                '瑞士': '🇨🇭', Switzerland: '🇨🇭',
                '瑞典': '🇸🇪', Sweden: '🇸🇪',
                '挪威': '🇳🇴', Norway: '🇳🇴',
                '丹麥': '🇩🇰', Denmark: '🇩🇰',
                '芬蘭': '🇫🇮', Finland: '🇫🇮'
            };

            const resolveCountryFlag = (country = '') => {
                const raw = String(country || '').trim();
                if (!raw) return '';
                if (/^[\u{1F1E6}-\u{1F1FF}]{2}/u.test(raw)) return '';
                return COUNTRY_FLAG_MAP[raw] || '';
            };

            const formatCountryDisplay = (country = '') => {
                const raw = String(country || '').trim();
                if (!raw) return '';
                if (cardData.showCountryFlag === false) return raw;
                const flag = resolveCountryFlag(raw);
                return flag ? `${flag} ${raw}` : raw;
            };

            const fontScale = Math.max(0.75, Math.min(2, (cardData.fontSize || 14) / 14));
            const scaleFont = (basePx) => `${Math.max(8, Math.round(basePx * fontScale))}px`;

            const getFilterStyle = () => {
                let filters = [];
                
                if (cardData.filterType !== 'none' && cardData.filterIntensity > 0) {
                    const intensity = cardData.filterIntensity / 100;
                    switch (cardData.filterType) {
                        case 'blur':
                            filters.push(`blur(${intensity * 5}px)`);
                            break;
                        case 'grayscale':
                            filters.push(`grayscale(${intensity})`);
                            break;
                        case 'invert':
                            filters.push(`invert(${intensity})`);
                            break;
                        case 'sepia':
                            filters.push(`sepia(${intensity})`);
                            break;
                    }
                }

                const brightness = cardData.brightness / 100;
                filters.push(`brightness(${brightness})`);
                
                const contrast = cardData.contrast / 100;
                filters.push(`contrast(${contrast})`);
                
                const saturation = cardData.saturation / 100;
                filters.push(`saturate(${saturation})`);
                
                if (cardData.hue !== 0) {
                    filters.push(`hue-rotate(${cardData.hue}deg)`);
                }
                
                if (cardData.sharpness !== 0) {
                    const sharpValue = 1 + (cardData.sharpness / 100);
                    filters.push(`contrast(${sharpValue})`);
                }
                
                if (cardData.blur > 0) {
                    filters.push(`blur(${cardData.blur}px)`);
                }

                return filters.join(' ');
            };

            const getAvatarStyle = () => {
                switch (cardData.avatarShape) {
                    case 'circular':
                        return { borderRadius: '50%' };
                    case 'square':
                        return { borderRadius: '0%' };
                    case 'roundedSquare':
                        return { borderRadius: `${cardData.borderRadiusInner}px` };
                    default:
                        return { borderRadius: '50%' };
                }
            };

            const getPatternStyle = () => {
                if (!cardData.bgPatternType || cardData.bgPatternType === 'none') return null;
                let pattern = BG_PATTERNS[cardData.bgPatternType];
                if (!pattern) return null;
                const isLightTheme = theme === 'light';
                const colorMap = {
                    'rgba(255,255,255,0.2)': isLightTheme ? 'rgba(102,126,234,0.22)' : 'rgba(255,255,255,0.2)',
                    'rgba(255,255,255,0.15)': isLightTheme ? 'rgba(102,126,234,0.16)' : 'rgba(255,255,255,0.15)',
                    'rgba(255,255,255,0.12)': isLightTheme ? 'rgba(102,126,234,0.13)' : 'rgba(255,255,255,0.12)',
                    'rgba(255,255,255,0.1)': isLightTheme ? 'rgba(102,126,234,0.11)' : 'rgba(255,255,255,0.1)',
                    'rgba(255,255,255,0.08)': isLightTheme ? 'rgba(102,126,234,0.09)' : 'rgba(255,255,255,0.08)'
                };
                Object.entries(colorMap).forEach(([from, to]) => {
                    pattern = pattern.replaceAll(from, to);
                });
                const scale = cardData.bgPatternScale || 1;
                const size = Math.max(20, 80 * scale);
                return {
                    position: 'absolute',
                    inset: 0,
                    backgroundImage: pattern,
                    backgroundSize: `${size}px ${size}px`,
                    opacity: cardData.bgPatternOpacity ?? 0.6,
                    pointerEvents: 'none',
                    zIndex: 4,
                    mixBlendMode: isLightTheme ? 'multiply' : 'screen'
                };
            };

            const getLightingStyle = () => {
                if (!cardData.lightingEffect || cardData.lightingEffect === 'none' || cardData.lightingIntensity <= 0) return null;
                const intensity = Math.min(100, Math.max(0, cardData.lightingIntensity)) / 100;

                if (cardData.lightingEffect === 'shadow') {
                    return {
                        position: 'absolute',
                        inset: 0,
                        pointerEvents: 'none',
                        zIndex: 8,
                        boxShadow: `inset 0 0 ${16 + intensity * 36}px rgba(0,0,0,${0.15 + intensity * 0.35})`
                    };
                }

                if (cardData.lightingEffect === 'glow') {
                    return {
                        position: 'absolute',
                        inset: 0,
                        pointerEvents: 'none',
                        zIndex: 8,
                        background: `radial-gradient(circle at 18% 20%, rgba(255,255,255,${0.12 + intensity * 0.28}), transparent 42%), radial-gradient(circle at 82% 78%, rgba(102,126,234,${0.1 + intensity * 0.24}), transparent 48%)`
                    };
                }

                return null;
            };

            const renderFreeDecoration = (item) => {
                const definition = DECORATIVE_ELEMENTS[item.element];
                if (!definition) return null;
                const baseStyle = {
                    position: 'absolute',
                    left: `${item.x ?? 10}%`,
                    top: `${item.y ?? 10}%`,
                    transform: `translate(-50%, -50%) rotate(${item.rotation || 0}deg)`,
                    opacity: (item.opacity ?? 100) / 100,
                    color: item.color || '#ffffff',
                    zIndex: 3,
                    pointerEvents: 'none'
                };

                if (definition.type === 'line') {
                    return (
                        <div
                            key={item.id}
                            style={{
                                ...baseStyle,
                                width: `${item.width || 120}px`,
                                height: `${item.thickness || 2}px`,
                                background: item.color || 'rgba(255,255,255,0.7)'
                            }}
                        ></div>
                    );
                }

                return (
                    <div
                        key={item.id}
                        style={{
                            ...baseStyle,
                            fontSize: `${item.size || 28}px`,
                            filter: 'drop-shadow(0 2px 6px rgba(0,0,0,0.15))'
                        }}
                    >
                        {definition.icon}
                    </div>
                );
            };

            const shadowStyle = `${cardData.shadowX}px ${cardData.shadowY}px ${cardData.shadowBlur}px ${cardData.shadowColor}`;
            const patternStyle = getPatternStyle();
            const lightingStyle = getLightingStyle();

            const downloadCard = async (format) => {
                setLoading(true);
                try {
                    if (cardRef.current) {
                        // 增加延遲以確保所有圖片都加載完畢
                        await new Promise(resolve => {
                            // 等待所有圖片加載
                            const images = cardRef.current.querySelectorAll('img');
                            let loadedCount = 0;
                            
                            if (images.length === 0) {
                                resolve();
                                return;
                            }
                            
                            const checkAllLoaded = () => {
                                loadedCount++;
                                if (loadedCount === images.length) resolve();
                            };
                            
                            images.forEach(img => {
                                if (img.complete) {
                                    checkAllLoaded();
                                } else {
                                    img.onload = img.onerror = checkAllLoaded;
                                }
                            });
                        });
                        
                        // 等待 html2canvas 準備好
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        const canvas = await html2canvas(cardRef.current, {
                            scale: 3,
                            useCORS: true,
                            allowTaint: false,
                            logging: false,
                            backgroundColor: cardType === 'custom' ? null : '#ffffff',
                            async: true,
                            imageTimeout: 15000,
                            onclone: (clonedDocument) => {
                                const clonedElement = clonedDocument.querySelector('.card-wrapper');
                                if (clonedElement) {
                                    clonedElement.style.animation = 'none';
                                    clonedElement.style.animationPlayState = 'running';
                                }
                            }
                        });
                        
                        // 轉換為 blob 並下載
                        canvas.toBlob((blob) => {
                            if (blob) {
                                saveAs(blob, `businesscard_${cardType}_${Date.now()}.${format === 'jpg' ? 'jpg' : format}`);
                            } else {
                                alert('無法生成圖片，請重試');
                            }
                            setLoading(false);
                        }, `image/${format === 'jpg' ? 'jpeg' : format === 'webp' ? 'webp' : 'png'}`, 0.95);
                    }
                } catch (error) {
                    console.error('Download failed:', error);
                    alert('匯出失敗：' + error.message);
                    setLoading(false);
                }
            };

            const downloadAsHTML = async () => {
                try {
                    // 生成邊框樣式
                    let borderStyle = '';
                    if (cardData.borderWidth > 0) {
                        if (cardData.borderUseGradient) {
                            borderStyle = `border: ${cardData.borderWidth}px solid transparent; background: linear-gradient(white, white), linear-gradient(135deg, ${cardData.borderGradientColor1}, ${cardData.borderGradientColor2}); background-origin: padding-box, border-box; background-clip: padding-box, border-box;`;
                        } else {
                            borderStyle = `border: ${cardData.borderWidth}px solid ${cardData.borderColor};`;
                        }
                    }
                    
                    // 生成動畫CSS
                    const animationCss = cardData.animationEffect && cardData.animationEffect !== 'none' ? 
                        `animation: ${cardData.animationEffect} ${cardData.animationDuration}s ${cardData.animationEasing} ${cardData.animationDelay}s ${cardData.animationLoops};` : '';
                    
                    // 生成背景圖案
                    let bgPatternStyle = '';
                    if (cardData.bgPatternType && cardData.bgPatternType !== 'none') {
                        const patternCss = BG_PATTERNS[cardData.bgPatternType];
                        const scale = cardData.bgPatternScale || 1;
                        const opacity = cardData.bgPatternOpacity || 1;
                        bgPatternStyle = `background-image: ${patternCss}; background-size: ${50 * scale}px ${50 * scale}px; opacity: ${opacity};`;
                    }
                    
                    // 生成社交媒體鏈接HTML
                    const socialLinksHtml = Object.entries(cardData.socialLinks || {})
                        .filter(([_, url]) => url)
                        .map(([platform, url]) => {
                            const socialMedia = SOCIAL_MEDIA[platform];
                            return socialMedia ? `<a href="${url}" target="_blank" style="display: inline-block; margin-right: 12px; font-size: 18px; text-decoration: none; color: ${socialMedia.color}; transition: transform 0.3s;" title="${socialMedia.name}" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">${socialMedia.icon}</a>` : '';
                        })
                        .join('');
                    
                    // 生成裝飾元素HTML
                    const decorativeHtml = cardData.decorativeElements && cardData.decorativeElements.length > 0 ? 
                        cardData.decorativeElements.map(elem => {
                            const decoration = DECORATIVE_ELEMENTS[elem];
                            if (!decoration) return '';
                            
                            if (decoration.type === 'line') {
                                let borderStyle = 'solid';
                                if (decoration.style === 'dashed') borderStyle = '2px dashed rgba(0,0,0,0.2)';
                                else if (decoration.style === 'dotted') borderStyle = '2px dotted rgba(0,0,0,0.2)';
                                else if (decoration.style === 'wave') borderStyle = '3px wavy rgba(0,0,0,0.2)';
                                else borderStyle = '1px solid rgba(0,0,0,0.2)';
                                
                                return `<div style="margin: 15px 0; border-top: ${borderStyle};"></div>`;
                            } else if (decoration.type === 'corner') {
                                return `<div style="position: absolute; font-size: 24px; opacity: 0.3;">${decoration.icon}</div>`;
                            } else if (decoration.type === 'icon') {
                                return `<div style="display: inline-block; margin: 0 6px; font-size: 18px; opacity: 0.4;">${decoration.icon}</div>`;
                            }
                        }).join('') : '';
                    
                    let cardContent = '';
                    
                    if (cardType === 'main') {
                        // 主卡片 - 使用與預覽相同的固定尺寸和樣式
                        cardContent = `
                            <div style="display: flex; flex-direction: row; width: 100%; height: 100%; background: linear-gradient(135deg, ${cardData.bgGradientColor1 || '#667eea'} 0%, ${cardData.bgGradientColor2 || '#764ba2'} 100%);">
                                <div style="width: 150px; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; flex-shrink: 0;">
                                    <img src="${cardData.avatar}" alt="Avatar" style="width: 120px; height: 120px; border-radius: ${cardData.avatarShape === 'circular' ? '50%' : cardData.avatarShape === 'square' ? '0%' : cardData.borderRadiusInner + 'px'}; object-fit: cover; border: 3px solid rgba(255,255,255,0.8); box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                                </div>
                                <div style="flex: 1; height: 100%; padding: 25px; display: flex; flex-direction: column; justify-content: space-between; background: rgba(255,255,255,0.98); max-width: 350px;">
                                    <div>
                                        <h2 style="margin: 0 0 6px 0; font-size: 22px; font-weight: bold; color: #1a1a1a; word-break: break-word;">${cardData.name}</h2>
                                        <p style="margin: 0 0 6px 0; font-size: 13px; color: #667eea; font-weight: 600; word-break: break-word;">${cardData.title} @ ${cardData.company}</p>
                                        ${decorativeHtml}
                                        <p style="margin: 4px 0; font-size: 11px; color: #666;">📍 ${formatCountryDisplay(cardData.country)}</p>
                                        ${cardData.address ? `<p style="margin: 4px 0; font-size: 11px; color: #666; word-break: break-word;">🏢 ${cardData.address}</p>` : ''}
                                        ${cardData.intro ? `<p style="margin: 4px 0; font-size: 10px; color: #888; line-height: 1.3;">💬 ${cardData.intro}</p>` : ''}
                                    </div>
                                    <div>
                                        <p style="margin: 4px 0; font-size: 11px; color: #667eea; word-break: break-all;">✉️ ${cardData.email}</p>
                                        <p style="margin: 4px 0; font-size: 11px; color: #667eea; word-break: break-word;">📱 ${cardData.phone}</p>
                                        <p style="margin: 4px 0; font-size: 11px; color: #667eea; word-break: break-all;">🌐 ${cardData.website}</p>
                                        ${socialLinksHtml ? `<div style="margin-top: 8px;">${socialLinksHtml}</div>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (cardType === 'qr') {
                        // QR卡片 - 使用與預覽相同的固定尺寸和樣式
                        cardContent = `
                            <div style="display: flex; gap: 30px; width: 100%; height: 100%; padding: 25px; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.98);">
                                <div style="flex: 1;">
                                    <h2 style="margin: 0 0 4px 0; font-size: 20px; font-weight: bold; color: #1a1a1a; word-break: break-word;">${cardData.name}</h2>
                                    <p style="margin: 0 0 4px 0; font-size: 12px; color: #667eea; font-weight: 600;">${cardData.title}${cardData.company ? ` @ ${cardData.company}` : ''}</p>
                                    ${decorativeHtml}
                                    ${cardData.intro ? `<p style="margin: 0 0 8px 0; font-size: 11px; color: #666; line-height: 1.4;">${cardData.intro}</p>` : ''}
                                    <div style="font-size: 10px; color: #666; line-height: 1.6;">
                                        ${cardData.country ? `<p>📍 ${formatCountryDisplay(cardData.country)}</p>` : ''}
                                        ${cardData.address ? `<p>🏢 ${cardData.address}</p>` : ''}
                                        <p>📧 ${cardData.email}</p>
                                        <p>📱 ${cardData.phone}</p>
                                        ${cardData.website ? `<p>🌐 ${cardData.website}</p>` : ''}
                                        ${socialLinksHtml ? `<div style="margin-top: 6px;">${socialLinksHtml}</div>` : ''}
                                    </div>
                                </div>
                                <div style="flex-shrink: 0; padding: 15px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" id="qr-code-export"></div>
                            </div>
                        `;
                    } else if (cardType === 'custom') {
                        const stickersHtml = textStickers.map(sticker => {
                            if (sticker.type === 'image') {
                                return `<img src="${sticker.image}" style="position: absolute; left: ${sticker.x || 10}%; top: ${sticker.y || 10}%; width: ${sticker.width || 100}px; height: ${sticker.height || 100}px; opacity: ${sticker.opacity / 100}; transform: rotate(${sticker.rotation || 0}deg); object-fit: contain; pointer-events: none;" alt="sticker" />`;
                            } else {
                                return `<div style="position: absolute; left: ${sticker.x || 10}%; top: ${sticker.y || 10}%; font-size: ${sticker.size}px; color: ${sticker.color || cardData.customCardTextColor}; opacity: ${sticker.opacity / 100}; font-weight: ${sticker.style === 'bold' ? 'bold' : 'normal'}; font-style: ${sticker.style === 'italic' ? 'italic' : 'normal'}; text-shadow: ${sticker.style === 'shadow' ? '2px 2px 4px rgba(0,0,0,0.5)' : sticker.style === 'outline' ? '-1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff' : 'none'}; transform: rotate(${sticker.rotation || 0}deg); pointer-events: none; white-space: nowrap; user-select: none;">${sticker.text}</div>`;
                            }
                        }).join('');
                        
                        const backgroundImage = customImage ? `url('${customImage}')` : cardData.customCardBgColor;
                        
                        cardContent = `
                            <div style="position: relative; width: 100%; height: 100%; background: ${backgroundImage}; background-size: cover; background-position: center;">
                                ${stickersHtml}
                                ${decorativeHtml}
                            </div>
                        `;
                    }
                    
                    const html = `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="專業名片 - ${cardData.name}">
    <meta name="author" content="${cardData.name}">
    <title>${cardData.name} - ${cardData.title || '名片'}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        html, body { 
            width: 100%; 
            height: 100%; 
        }
        
        body { 
            font-family: '${cardData.fontFamily}', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 0; 
            padding: 15px; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
        }
        
        .card-wrapper { 
            width: 500px; 
            height: 300px; 
            background: white; 
            padding: 0; 
            border-radius: ${cardData.borderRadiusOuter}px; 
            box-shadow: ${cardData.shadowX}px ${cardData.shadowY}px ${cardData.shadowBlur}px ${cardData.shadowColor}; 
            overflow: hidden;
            animation-duration: 1s;
            animation-iteration-count: infinite;
            ${borderStyle}
            ${animationCss}
            filter: brightness(${cardData.brightness}%) contrast(${cardData.contrast}%) saturate(${cardData.saturation}%) hue-rotate(${cardData.hue}deg)${cardData.blur > 0 ? ` blur(${cardData.blur}px)` : ''};
        }
        
        h2 { 
            color: #1a1a1a; 
            font-weight: 700;
            margin: 0;
        }
        
        p { 
            color: #555; 
            line-height: 1.6;
            margin: 0;
        }
        
        img { 
            max-width: 100%; 
            height: auto;
            display: block;
        }
        
        a {
            transition: all 0.3s ease;
        }
        
        /* 响应式设计 */
        @media (max-width: 1024px) {
            body { 
                padding: 12px; 
            }
            .card-wrapper { 
                width: 450px;
                height: 270px;
            }
        }
        
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
            }
            .card-wrapper { 
                width: 400px;
                height: 240px;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            .card-wrapper {
                width: 100%;
                height: auto;
                min-height: 240px;
            }
        }
        
        /* 动画定义 */
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        @keyframes slideInUp { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes slideInLeft { 
            from { opacity: 0; transform: translateX(-20px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        @keyframes slideInRight { 
            from { opacity: 0; transform: translateX(20px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        @keyframes bounce { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-10px); } 
        }
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.7; } 
        }
    </style>
</head>
<body>
    <div class="card-wrapper">
        ${cardContent}
    </div>
    <script>
        // 動畫播放控制
        const cardWrapper = document.querySelector('.card-wrapper');
        if (cardWrapper) {
            cardWrapper.addEventListener('click', function(e) {
                if (e.target.closest('.card-wrapper')) {
                    this.style.animationPlayState = this.style.animationPlayState === 'paused' ? 'running' : 'paused';
                }
            });
        }
        
        // QR 碼生成
        if (document.getElementById('qr-code-export')) {
            try {
                new QRCode(document.getElementById('qr-code-export'), {
                    text: '${qrContent || `${cardData.name}|${cardData.email}|${cardData.phone}`}',
                    width: 150,
                    height: 150,
                    colorDark: '#333',
                    colorLight: '#fff'
                });
            } catch(e) {
                console.error('QR Code generation failed:', e);
            }
        }
    <\/script>
</body>
</html>`;
                    const blob = new Blob([html], { type: 'text/html' });
                    saveAs(blob, `${cardData.name}_${cardType}_card.html`);
                } catch (error) {
                    console.error('HTML export failed:', error);
                }
            };

            const downloadAsVCF = () => {
                try {
                    const vcf = `BEGIN:VCARD
VERSION:3.0
FN:${cardData.name}
TITLE:${cardData.title}
ORG:${cardData.company}
ADRTYPE:WORK
ADR:;;${cardData.address};;${cardData.country}
EMAIL:${cardData.email}
TEL:${cardData.phone}
URL:${cardData.website}
NOTE:${cardData.intro}
END:VCARD`;
                    const blob = new Blob([vcf], { type: 'text/vcard' });
                    saveAs(blob, `${cardData.name}.vcf`);
                } catch (error) {
                    console.error('VCF export failed:', error);
                }
            };

            useEffect(() => {
                if (cardType === 'qr' && cardData.name) {
                    const qrContainer = document.getElementById('qr-code');
                    if (qrContainer) {
                        qrContainer.innerHTML = '';
                        let qrText = qrContent || `${cardData.name}|${cardData.email}|${cardData.phone}`;
                        const qrSize = window.innerWidth <= 480 ? 78 : window.innerWidth <= 768 ? 96 : 150;
                        try {
                            new QRCode(qrContainer, {
                                text: qrText,
                                width: qrSize,
                                height: qrSize,
                                colorDark: '#333',
                                colorLight: '#fff'
                            });
                        } catch (e) {
                            console.error('QR Code generation error:', e);
                        }
                    }
                }
            }, [cardType, cardData.name, cardData.email, cardData.phone, qrContent]);

            const [animationKey, setAnimationKey] = useState(0);
            const [isAnimationPlaying, setIsAnimationPlaying] = useState(true);

            // 触发动画重播效果
            const triggerAnimationReplay = () => {
                setAnimationKey(prev => prev + 1);
                setIsAnimationPlaying(true);
            };

            // 切换动画播放/暂停状态
            const toggleAnimationPlayPause = () => {
                const cardElement = cardRef.current;
                if (cardElement) {
                    if (isAnimationPlaying) {
                        cardElement.style.animationPlayState = 'paused';
                        setIsAnimationPlaying(false);
                    } else {
                        cardElement.style.animationPlayState = 'running';
                        setIsAnimationPlaying(true);
                    }
                }
            };

            useEffect(() => {
                const runPreviewAction = async (detail = {}) => {
                    const action = detail.action;
                    if (!action) return { ok: false, message: 'Missing preview action' };

                    if (action === 'export') {
                        const format = detail.format || 'png';
                        if (['png', 'jpg', 'webp'].includes(format)) {
                            await downloadCard(format);
                            return { ok: true, action, format };
                        }
                        if (format === 'html') {
                            await downloadAsHTML();
                            return { ok: true, action, format };
                        }
                        if (format === 'vcf') {
                            await downloadAsVCF();
                            return { ok: true, action, format };
                        }
                        throw new Error(`Unsupported export format: ${format}`);
                    }

                    if (action === 'animation.replay') {
                        triggerAnimationReplay();
                        return { ok: true, action };
                    }

                    if (action === 'animation.toggle') {
                        toggleAnimationPlayPause();
                        return { ok: true, action };
                    }

                    throw new Error(`Unsupported preview action: ${action}`);
                };

                const onPreviewAction = async (event) => {
                    try {
                        await runPreviewAction(event.detail || {});
                    } catch (error) {
                        console.warn('[WebMCP][Preview] Action error:', error);
                    }
                };

                window.VirtualCardPreviewActions = { run: runPreviewAction };
                window.addEventListener('VC_PREVIEW_ACTION', onPreviewAction);

                return () => {
                    window.removeEventListener('VC_PREVIEW_ACTION', onPreviewAction);
                    if (window.VirtualCardPreviewActions && window.VirtualCardPreviewActions.run === runPreviewAction) {
                        delete window.VirtualCardPreviewActions;
                    }
                };
            }, [cardType, qrContent, cardData, isAnimationPlaying]);

            return (
                <div className="preview-panel">
                    {/* 动画控制按钮 - 位置调整为右上角，不与卡片重叠 */}
                    <div className="animation-controls" style={{
                        position: 'absolute',
                        top: '15px',
                        right: '15px',
                        display: 'flex',
                        gap: '10px',
                        zIndex: 100,
                        background: 'rgba(255, 255, 255, 0.95)',
                        padding: '8px 12px',
                        borderRadius: '8px',
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'
                    }}>
                        {/* 播放/暂停切换按钮 */}
                        <button
                            onClick={toggleAnimationPlayPause}
                            style={{
                                padding: '6px 10px',
                                backgroundColor: isAnimationPlaying ? '#667eea' : '#999',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer',
                                fontSize: '13px',
                                fontWeight: '600',
                                transition: 'all 0.3s ease',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '5px'
                            }}
                            title={isAnimationPlaying ? (t.pauseAnimation || '暫停動畫') : (t.playAnimation || '播放動畫')}
                        >
                            {isAnimationPlaying ? '⏸' : '▶'}
                        </button>
                        {/* 重播按钮 */}
                        <button
                            onClick={triggerAnimationReplay}
                            style={{
                                padding: '6px 10px',
                                backgroundColor: '#764ba2',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer',
                                fontSize: '13px',
                                fontWeight: '600',
                                transition: 'all 0.3s ease'
                            }}
                            title={t.replayAnimation || '重新播放'}
                        >
                            🔄
                        </button>
                    </div>
                    <div className="preview-container">
                        <div 
                            ref={cardRef}
                            key={animationKey}
                            className={`card-wrapper ${cardData.animationEffect && cardData.animationEffect !== 'none' ? `animate__animated animate__${cardData.animationEffect}` : ''}`}
                            style={{
                                '--card-font-scale': fontScale,
                                borderRadius: `${cardData.borderRadiusOuter}px`,
                                filter: getFilterStyle(),
                                boxShadow: shadowStyle,
                                animationDuration: cardData.animationEffect !== 'none' ? `${cardData.animationDuration}s` : '1s',
                                animationDelay: cardData.animationEffect !== 'none' ? `${cardData.animationDelay}s` : '0s',
                                animationIterationCount: cardData.animationLoops || 'infinite',
                                animationTimingFunction: cardData.animationEasing || 'ease-in-out',
                                border: cardData.borderWidth > 0 ? 
                                    (cardData.borderUseGradient ? 
                                        `${cardData.borderWidth}px solid transparent` : 
                                        `${cardData.borderWidth}px solid ${cardData.borderColor}`) 
                                    : 'none',
                                backgroundImage: cardData.borderWidth > 0 && cardData.borderUseGradient ?
                                    `linear-gradient(white, white), linear-gradient(135deg, ${cardData.borderGradientColor1}, ${cardData.borderGradientColor2})` 
                                    : 'none',
                                backgroundOrigin: cardData.borderUseGradient ? 'border-box, padding-box' : 'unset',
                                backgroundClip: cardData.borderUseGradient ? 'padding-box, border-box' : 'unset',
                                fontFamily: cardData.fontFamily,
                                fontSize: `${cardData.fontSize}px`,
                                backdropFilter: cardData.bgPatternType !== 'none' ? 'blur(0px)' : 'none'
                            }}
                        >
                            {patternStyle && <div style={patternStyle}></div>}
                            {freeDecorations.map(item => renderFreeDecoration(item))}
                            {cardType === 'main' && (
                                <div className="main-card-wrapper" style={{ background: `linear-gradient(135deg, ${cardData.bgGradientColor1 || '#667eea'} 0%, ${cardData.bgGradientColor2 || '#764ba2'} 100%)`, position: 'relative', zIndex: 2 }}>
                                    <div className="main-card-left">
                                        <img 
                                            src={cardData.avatar} 
                                            alt="avatar"
                                            className="card-avatar"
                                            style={getAvatarStyle()}
                                        />
                                    </div>
                                    <div className="main-card-right">
                                        <div>
                                            <h2 style={{ fontSize: scaleFont(22), fontWeight: 'bold', marginBottom: '3px', color: '#1a1a1a' }}>
                                                {cardData.name}
                                            </h2>
                                            <p style={{ fontSize: scaleFont(13), color: '#667eea', marginBottom: '6px', fontWeight: '600' }}>
                                                {cardData.title} @ {cardData.company}
                                            </p>
                                            {cardData.decorativeElements && cardData.decorativeElements.map((elemKey, idx) => {
                                                const elem = DECORATIVE_ELEMENTS[elemKey];
                                                if (!elem || elem.type !== 'line') return null;
                                                return (
                                                    <div key={idx} style={{
                                                        margin: '4px 0',
                                                        borderTop: elem.style === 'dashed' ? '2px dashed rgba(0,0,0,0.2)' :
                                                                   elem.style === 'dotted' ? '2px dotted rgba(0,0,0,0.2)' :
                                                                   '1px solid rgba(0,0,0,0.15)'
                                                    }}></div>
                                                );
                                            })}
                                            <p style={{ fontSize: scaleFont(11), color: '#666', marginBottom: '2px' }}>
                                                📍 {formatCountryDisplay(cardData.country)}
                                            </p>
                                            {cardData.address && (
                                                <p style={{ fontSize: scaleFont(11), color: '#666', marginBottom: '2px' }}>
                                                    🏢 {cardData.address}
                                                </p>
                                            )}
                                            {cardData.intro && (
                                                <p style={{ fontSize: scaleFont(10), color: '#888', marginTop: '3px', lineHeight: '1.3', overflow: 'hidden', textOverflow: 'ellipsis', display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical' }}>
                                                    💬 {cardData.intro}
                                                </p>
                                            )}
                                        </div>

                                        <div style={{ fontSize: scaleFont(11), color: '#666' }}>
                                            {cardData.showEmail !== false && <p style={{ marginBottom: '1px' }}>✉️ {cardData.email}</p>}
                                            {cardData.showPhone !== false && <p style={{ marginBottom: '1px' }}>📱 {cardData.phone}</p>}
                                            {cardData.showWebsite !== false && <p style={{ marginBottom: '1px' }}>🌐 {cardData.website}</p>}
                                            {Object.entries(cardData.socialLinks || {}).filter(([_, url]) => url).length > 0 && (
                                                <div style={{ marginTop: '4px' }}>
                                                    {Object.entries(cardData.socialLinks).filter(([_, url]) => url).map(([key, url]) => (
                                                        <span key={key} style={{ marginRight: '5px', fontSize: scaleFont(13) }} title={SOCIAL_MEDIA[key]?.name}>{SOCIAL_MEDIA[key]?.icon}</span>
                                                    ))}
                                                </div>
                                            )}
                                            {cardData.decorativeElements && cardData.decorativeElements.map((elemKey, idx) => {
                                                const elem = DECORATIVE_ELEMENTS[elemKey];
                                                if (!elem || elem.type !== 'icon') return null;
                                                return <span key={idx} style={{ marginRight: '6px', opacity: 0.4 }}>{elem.icon}</span>;
                                            })}
                                        </div>
                                    </div>
                                    {cardData.decorativeElements && cardData.decorativeElements.map((elemKey, idx) => {
                                        const elem = DECORATIVE_ELEMENTS[elemKey];
                                        if (!elem || elem.type !== 'corner') return null;
                                        return (
                                            <div key={idx} style={{
                                                position: 'absolute',
                                                fontSize: '24px',
                                                opacity: 0.3,
                                                top: idx % 2 === 0 ? '5px' : 'auto',
                                                bottom: idx % 2 !== 0 ? '5px' : 'auto',
                                                left: idx < 2 ? '10px' : 'auto',
                                                right: idx >= 2 ? '10px' : 'auto'
                                            }}>{elem.icon}</div>
                                        );
                                    })}
                                </div>
                            )}

                            {cardType === 'qr' && (
                                <div className="qr-card-wrapper" style={{ position: 'relative', zIndex: 2 }}>
                                    <div className="qr-card-left">
                                        <h2 className="qr-name" style={{ fontWeight: 'bold', color: '#1a1a1a' }}>
                                            {cardData.name}
                                        </h2>
                                        <p className="qr-role" style={{ color: '#667eea', fontWeight: '600' }}>
                                            {cardData.title}{cardData.company ? ` @ ${cardData.company}` : ''}
                                        </p>
                                        {cardData.decorativeElements && cardData.decorativeElements.map((elemKey, idx) => {
                                            const elem = DECORATIVE_ELEMENTS[elemKey];
                                            if (!elem || elem.type !== 'line') return null;
                                            return (
                                                <div key={idx} style={{
                                                    margin: '4px 0',
                                                    borderTop: elem.style === 'dashed' ? '2px dashed rgba(0,0,0,0.2)' :
                                                               elem.style === 'dotted' ? '2px dotted rgba(0,0,0,0.2)' :
                                                               '1px solid rgba(0,0,0,0.15)'
                                                }}></div>
                                            );
                                        })}
                                        {cardData.intro && (
                                            <p className="qr-intro" style={{ color: '#666' }}>
                                                {cardData.intro}
                                            </p>
                                        )}
                                        <div className="qr-contact-list" style={{ color: '#666' }}>
                                            {cardData.country && <p className="qr-contact-item">📍 {formatCountryDisplay(cardData.country)}</p>}
                                            {cardData.address && <p className="qr-contact-item">🏢 {cardData.address}</p>}
                                            <p className="qr-contact-item">📧 {cardData.email}</p>
                                            <p className="qr-contact-item">📱 {cardData.phone}</p>
                                            {cardData.website && <p className="qr-contact-item">🌐 {cardData.website}</p>}
                                            {Object.entries(cardData.socialLinks || {}).filter(([_, url]) => url).length > 0 && (
                                                <div className="qr-social-list">
                                                    {Object.entries(cardData.socialLinks).filter(([_, url]) => url).map(([key, url]) => (
                                                        <span key={key} className="qr-social-icon" title={SOCIAL_MEDIA[key]?.name}>{SOCIAL_MEDIA[key]?.icon}</span>
                                                    ))}
                                                </div>
                                            )}
                                            {cardData.decorativeElements && cardData.decorativeElements.map((elemKey, idx) => {
                                                const elem = DECORATIVE_ELEMENTS[elemKey];
                                                if (!elem || elem.type !== 'icon') return null;
                                                return <span key={idx} style={{ marginRight: '6px', opacity: 0.4 }}>{elem.icon}</span>;
                                            })}
                                        </div>
                                    </div>

                                    <div className="qr-card-right">
                                        <div id="qr-code" className="qr-code-box" style={{ backgroundColor: '#fff', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}></div>
                                        <p className="qr-scan-text" style={{ color: '#999', textAlign: 'center' }}>{t.scanToContact}</p>
                                    </div>
                                </div>
                            )}

                            {cardType === 'custom' && (
                                <div className="custom-card-wrapper" style={{
                                    background: customImage ? `url(${customImage})` : cardData.customCardBgColor,
                                    backgroundSize: 'cover',
                                    backgroundPosition: 'center',
                                    backgroundImage: customImage ? `url(${customImage})` : 'none'
                                }}>
                                    {textStickers.map(sticker => {
                                        const isImageSticker = sticker.type === 'image';
                                        return isImageSticker ? (
                                            <img
                                                key={sticker.id}
                                                src={sticker.image}
                                                className="sticker-item"
                                                style={{
                                                    left: `${sticker.x || 10}%`,
                                                    top: `${sticker.y || 10}%`,
                                                    width: `${sticker.width || 100}px`,
                                                    height: `${sticker.height || 100}px`,
                                                    opacity: sticker.opacity / 100,
                                                    transform: `rotate(${sticker.rotation || 0}deg)`,
                                                    objectFit: 'contain'
                                                }}
                                            />
                                        ) : (
                                            <div
                                                key={sticker.id}
                                                className="sticker-item"
                                                style={{
                                                    left: `${sticker.x || 10}%`,
                                                    top: `${sticker.y || 10}%`,
                                                    fontSize: `${sticker.size}px`,
                                                    color: sticker.color || cardData.customCardTextColor,
                                                    opacity: sticker.opacity / 100,
                                                    fontWeight: sticker.style === 'bold' ? 'bold' : 'normal',
                                                    fontStyle: sticker.style === 'italic' ? 'italic' : 'normal',
                                                    textShadow: sticker.style === 'shadow' ? '2px 2px 4px rgba(0,0,0,0.5)' : 
                                                                sticker.style === 'outline' ? '-1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff' :
                                                                sticker.style === 'glow' ? '0 0 10px rgba(255,255,255,0.8)' : 'none',
                                                    transform: `rotate(${sticker.rotation || 0}deg)`
                                                }}
                                            >
                                                {sticker.text}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}

                            {lightingStyle && <div style={lightingStyle}></div>}
                        </div>
                    </div>

                    <div className="export-buttons">
                        <button className="btn-export" onClick={() => downloadCard('png')}>📥 PNG</button>
                        <button className="btn-export alt" onClick={() => downloadCard('jpg')}>📥 JPG</button>
                        <button className="btn-export" onClick={() => downloadCard('webp')}>📥 WebP</button>
                        <button className="btn-export alt" onClick={downloadAsHTML}>🌐 HTML</button>
                        <button className="btn-export" onClick={downloadAsVCF}>📇 VCF</button>
                    </div>
                </div>
            );
        }

        function StickerEditor({ sticker, onUpdate, onRemove, t = {} }) {
            const isImageSticker = sticker.type === 'image';
            
            return (
                <div className="sticker-editor">
                    <div className="sticker-header">
                        <span className="sticker-id">{t.stickerLabel || '貼圖'} #{sticker.id} {isImageSticker ? '🖼️' : '📝'}</span>
                        <button
                            onClick={() => onRemove(sticker.id)}
                            className="btn-delete"
                        >
                            🗑️ {t.deleteLabel || '刪除'}
                        </button>
                    </div>

                    {isImageSticker ? (
                        <>
                            <div>
                                <label className="control-label">{t.imagePreview || '圖片預覽'}</label>
                                <div style={{ maxWidth: '100px', maxHeight: '100px', marginBottom: '8px', borderRadius: '4px', overflow: 'hidden', border: '1px solid #ddd' }}>
                                    <img src={sticker.image} style={{ width: '100%', height: '100%', objectFit: 'contain' }} />
                                </div>
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', marginBottom: '8px' }}>
                                <div>
                                    <label className="control-label">{t.xPositionLabel || 'X 位置'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={sticker.x || 10}
                                            onChange={(e) => onUpdate(sticker.id, { x: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.x || 10}%</span>
                                    </div>
                                </div>
                                <div>
                                    <label className="control-label">{t.yPositionLabel || 'Y 位置'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={sticker.y || 10}
                                            onChange={(e) => onUpdate(sticker.id, { y: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.y || 10}%</span>
                                    </div>
                                </div>
                            </div>

                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', marginBottom: '8px' }}>
                                <div>
                                    <label className="control-label">{t.widthLabel || '寬度'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="20"
                                            max="300"
                                            value={sticker.width || 100}
                                            onChange={(e) => onUpdate(sticker.id, { width: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.width || 100}px</span>
                                    </div>
                                </div>
                                <div>
                                    <label className="control-label">{t.heightLabel || '高度'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="20"
                                            max="300"
                                            value={sticker.height || 100}
                                            onChange={(e) => onUpdate(sticker.id, { height: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.height || 100}px</span>
                                    </div>
                                </div>
                            </div>
                        </>
                    ) : (
                        <>
                            <input
                                type="text"
                                value={sticker.text}
                                onChange={(e) => onUpdate(sticker.id, { text: e.target.value })}
                                placeholder={t.textContent || '文字內容'}
                                className="control-input"
                                style={{ marginBottom: '8px' }}
                            />
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', marginBottom: '8px' }}>
                                <div>
                                    <label className="control-label">{t.xPositionLabel || 'X 位置'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={sticker.x || 10}
                                            onChange={(e) => onUpdate(sticker.id, { x: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.x || 10}%</span>
                                    </div>
                                </div>
                                <div>
                                    <label className="control-label">{t.yPositionLabel || 'Y 位置'}</label>
                                    <div className="slider-wrapper">
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={sticker.y || 10}
                                            onChange={(e) => onUpdate(sticker.id, { y: parseInt(e.target.value) })}
                                        />
                                        <span className="slider-value">{sticker.y || 10}%</span>
                                    </div>
                                </div>
                            </div>

                            <label className="control-label" style={{ marginTop: '8px' }}>{t.stickerStyle || '貼圖樣式'}</label>
                            <div className="sticker-style-grid">
                                {Object.entries(STICKER_STYLES).map(([key, style]) => (
                                    <button
                                        key={key}
                                        onClick={() => onUpdate(sticker.id, { style: key })}
                                        className={`sticker-style-btn ${sticker.style === key ? 'active' : ''}`}
                                    >
                                        {t[style.label]}
                                    </button>
                                ))}
                            </div>

                            <div>
                                <label className="control-label">{t.sizeLabel || '大小'}</label>
                                <div className="slider-wrapper">
                                    <input
                                        type="range"
                                        min="12"
                                        max="32"
                                        value={sticker.size}
                                        onChange={(e) => onUpdate(sticker.id, { size: parseInt(e.target.value) })}
                                    />
                                    <span className="slider-value">{sticker.size}px</span>
                                </div>
                            </div>

                            <div>
                                <label className="control-label">{t.colorLabel || '顏色'}</label>
                                <input
                                    type="color"
                                    value={sticker.color}
                                    onChange={(e) => onUpdate(sticker.id, { color: e.target.value })}
                                    className="color-picker"
                                />
                            </div>
                        </>
                    )}

                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', marginBottom: '8px' }}>
                        <div>
                            <label className="control-label">{t.rotationLabel || '旋轉'}</label>
                            <div className="slider-wrapper">
                                <input
                                    type="range"
                                    min="0"
                                    max="360"
                                    value={sticker.rotation || 0}
                                    onChange={(e) => onUpdate(sticker.id, { rotation: parseInt(e.target.value) })}
                                />
                                <span className="slider-value">{sticker.rotation || 0}°</span>
                            </div>
                        </div>
                        <div>
                            <label className="control-label">{t.opacityLabel || '不透明度'}</label>
                            <div className="slider-wrapper">
                                <input
                                    type="range"
                                    min="0"
                                    max="100"
                                    value={sticker.opacity}
                                    onChange={(e) => onUpdate(sticker.id, { opacity: parseInt(e.target.value) })}
                                />
                                <span className="slider-value">{sticker.opacity}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                if (isStandalone) {
                    document.documentElement.classList.add('pwa-standalone');
                }

                navigator.serviceWorker.register('./sw.js', { scope: './' })
                    .then((registration) => {
                        console.log('[PWA] Service Worker registered successfully:', registration);
                        if (registration.waiting) {
                            registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        }
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            if (!newWorker) return;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
